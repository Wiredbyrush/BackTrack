<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <title>Admin Panel - BackTrack</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/nav-auth.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            height: 70px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            z-index: 100;
        }

        .nav-spacer {
            height: 70px;
        }

        .nav-left {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .nav-left img {
            height: 60px;
            width: auto;
        }

        .nav-center {
            display: flex;
            gap: 40px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.45);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .nav-link.active {
            color: #fff;
        }

        .nav-right {
            display: flex;
            align-items: center;
        }

        .sign-in-btn {
            background: linear-gradient(180deg, #2e2e2e 0%, #1a1a1a 100%);
            color: #f3f4f6;
            border: 1px solid #3f3f3f;
            padding: 8px 18px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
        }

        /* Admin Layout */
        .admin-layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .admin-sidebar {
            width: 240px;
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid rgba(255, 255, 255, 0.06);
            padding: 28px 16px;
            flex-shrink: 0;
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .sidebar-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #555;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-bottom: 28px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
        }

        .sidebar-link:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.04);
        }

        .sidebar-link.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.08);
        }

        .sidebar-link .link-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .sidebar-link .link-badge {
            margin-left: auto;
            background: rgba(255, 255, 255, 0.08);
            padding: 2px 8px;
            border-radius: 99px;
            font-size: 11px;
            font-weight: 700;
            color: #888;
        }

        .sidebar-link.active .link-badge {
            background: rgba(37, 99, 235, 0.15);
            color: #60a5fa;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            padding: 36px 40px 80px;
            max-width: 960px;
        }

        .admin-main-title {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 6px;
        }

        .admin-main-desc {
            color: #666;
            font-size: 14px;
            margin-bottom: 32px;
        }

        /* Panel visibility */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        /* Dashboard Stats */
        .dash-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 36px;
        }

        .dash-stat {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 14px;
            padding: 20px;
        }

        .dash-stat-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .dash-stat-value {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .dash-stat-value.pending {
            color: #f59e0b;
        }

        .dash-stat-value.claims {
            color: #6366f1;
        }

        .dash-stat-value.bounties {
            color: #ec4899;
        }

        .dash-stat-value.active {
            color: #22c55e;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
            margin-bottom: 36px;
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 14px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }

        .quick-action:hover {
            border-color: rgba(255, 255, 255, 0.12);
            background: rgba(255, 255, 255, 0.04);
        }

        .quick-action-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .quick-action-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quick-action-title {
            font-size: 14px;
            font-weight: 700;
        }

        .quick-action-desc {
            font-size: 12px;
            color: #666;
        }

        /* Status Banner */
        .admin-status {
            padding: 14px 18px;
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 10px;
            color: #fca5a5;
            font-size: 14px;
            margin-bottom: 24px;
            display: none;
        }

        .admin-status.visible {
            display: block;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
        }

        .section-count {
            background: rgba(255, 255, 255, 0.06);
            padding: 3px 10px;
            border-radius: 99px;
            font-size: 12px;
            color: #999;
            font-weight: 600;
        }

        /* Cards */
        .cards-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .review-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 14px;
            padding: 20px 24px;
            transition: border-color 0.2s;
        }

        .review-card:hover {
            border-color: rgba(255, 255, 255, 0.12);
        }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
        }

        .card-info {
            flex: 1;
            min-width: 0;
        }

        .card-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .card-meta {
            color: #777;
            font-size: 13px;
            line-height: 1.6;
        }

        .card-proof {
            margin-top: 10px;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            color: #aaa;
            font-size: 13px;
            line-height: 1.5;
        }

        .card-proof strong {
            color: #ccc;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            font-family: inherit;
        }

        .btn:hover {
            opacity: 0.85;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-approve {
            background: #22c55e;
            color: #052e16;
        }

        .btn-reject {
            background: rgba(239, 68, 68, 0.12);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .card-status {
            margin-top: 10px;
            font-size: 13px;
            color: #22c55e;
        }

        .card-status.error {
            color: #fca5a5;
        }

        .empty-state {
            text-align: center;
            padding: 48px 20px;
            color: #555;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #555;
            font-size: 14px;
        }

        /* Urgency Badges */
        .urgency-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 99px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .urgency-low {
            background: rgba(37, 99, 235, 0.1);
            color: #60a5fa;
        }

        .urgency-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
        }

        .urgency-high {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
        }

        /* Map filter buttons */
        .filter-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .filter-btn {
            padding: 7px 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: transparent;
            color: #888;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .filter-btn:hover {
            border-color: rgba(255, 255, 255, 0.15);
            color: #ccc;
        }

        .filter-btn.active {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dash-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .admin-sidebar {
                display: none;
            }

            .admin-main {
                padding: 24px 20px 60px;
            }

            .dash-stats {
                grid-template-columns: 1fr 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .card-top {
                flex-direction: column;
            }

            .card-actions {
                width: 100%;
            }

            .btn {
                flex: 1;
                text-align: center;
            }

            nav {
                padding: 0 20px;
            }

            /* Mobile nav tabs */
            .mobile-tabs {
                display: flex;
                gap: 4px;
                padding: 12px 20px;
                overflow-x: auto;
                border-bottom: 1px solid rgba(255, 255, 255, 0.06);
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(8px);
            }

            .mobile-tab {
                padding: 8px 14px;
                border-radius: 8px;
                border: none;
                background: transparent;
                color: #888;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                white-space: nowrap;
                font-family: inherit;
            }

            .mobile-tab.active {
                background: rgba(255, 255, 255, 0.08);
                color: #fff;
            }
        }

        @media (min-width: 769px) {
            .mobile-tabs {
                display: none;
            }
        }

        /* ===== DASHBOARD REDESIGN ===== */
        .dash-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .dash-header-actions {
            display: flex;
            gap: 8px;
        }

        .dash-export-btn {
            padding: 7px 16px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.04);
            color: #aaa;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }

        .dash-export-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .analytics-range-select {
            padding: 7px 14px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.04);
            color: #aaa;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
        }

        .analytics-range-select option {
            background: #111;
            color: #ccc;
        }

        /* KPI Cards */
        .dash-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .dash-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .dash-kpi {
            background: rgba(255, 255, 255, 0.025);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 16px 18px;
        }

        .kpi-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .kpi-label {
            font-size: 11px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .kpi-spark {
            display: block;
        }

        .kpi-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .kpi-badge.positive {
            background: rgba(34, 197, 94, 0.12);
            color: #4ade80;
        }

        .kpi-value {
            font-size: 30px;
            font-weight: 800;
            letter-spacing: -1px;
            line-height: 1;
            margin-bottom: 4px;
        }

        .kpi-unit {
            font-size: 18px;
            font-weight: 600;
            color: #888;
        }

        .kpi-sub {
            font-size: 11px;
            color: #555;
            font-weight: 500;
        }

        /* Trend Chart */
        .dash-chart-wrap {
            background: rgba(255, 255, 255, 0.025);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .dash-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dash-chart-title {
            font-size: 14px;
            font-weight: 700;
            color: #e5e5e5;
        }

        .dash-chart-subtitle {
            font-size: 11px;
            color: #555;
            margin-top: 2px;
            font-weight: 500;
        }

        .dash-chart-legend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #888;
            font-weight: 500;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        #dashTrendChart {
            width: 100%;
            height: 200px;
        }

        /* Bottom Grid */
        .dash-bottom-grid {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 16px;
        }

        @media (max-width: 900px) {
            .dash-bottom-grid {
                grid-template-columns: 1fr;
            }
        }

        .dash-recent-card,
        .dash-actions-card {
            background: rgba(255, 255, 255, 0.025);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 18px;
        }

        .dash-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .dash-card-title {
            font-size: 13px;
            font-weight: 700;
            color: #ccc;
        }

        .dash-card-link {
            font-size: 11px;
            color: #3b82f6;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .dash-card-link:hover {
            color: #60a5fa;
        }

        /* Recent Activity Mini-Feed */
        .dash-recent-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .dash-recent-item:last-child {
            border-bottom: none;
        }

        .dash-recent-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .dash-recent-text {
            font-size: 12px;
            color: #aaa;
            flex: 1;
            font-weight: 500;
        }

        .dash-recent-time {
            font-size: 10px;
            color: #555;
            font-weight: 600;
            flex-shrink: 0;
        }

        /* Quick Actions Grid */
        .dash-qa-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .dash-qa {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: transparent;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
            text-align: left;
        }

        .dash-qa:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.08);
        }

        .qa-icon {
            font-size: 14px;
            flex-shrink: 0;
        }

        .qa-text {
            font-size: 11px;
            color: #aaa;
            font-weight: 600;
            flex: 1;
        }

        .qa-count {
            font-size: 10px;
            color: #666;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.06);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* ===== ANALYTICS REDESIGN ===== */
        .metric-strip {
            display: flex;
            align-items: center;
            gap: 0;
            background: rgba(255, 255, 255, 0.025);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 16px 4px;
            margin-bottom: 20px;
        }

        .metric-item {
            flex: 1;
            text-align: center;
            padding: 0 12px;
        }

        .metric-value {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: #fff;
        }

        .metric-label {
            font-size: 10px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .metric-change {
            font-size: 10px;
            font-weight: 700;
            margin-top: 4px;
        }

        .metric-change.positive {
            color: #4ade80;
        }

        .metric-change.negative {
            color: #f87171;
        }

        .metric-divider {
            width: 1px;
            height: 36px;
            background: rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .metric-strip {
                flex-wrap: wrap;
                gap: 12px;
            }

            .metric-divider {
                display: none;
            }

            .metric-item {
                min-width: 80px;
            }
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        @media (max-width: 900px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.025);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 20px;
        }

        .chart-card canvas {
            width: 100%;
            display: block;
        }

        .chart-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-card-title {
            font-size: 14px;
            font-weight: 700;
            color: #e5e5e5;
        }

        .chart-card-subtitle {
            font-size: 11px;
            color: #555;
            font-weight: 500;
        }

        .chart-card-tabs {
            display: flex;
            gap: 2px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 6px;
            padding: 2px;
        }

        .chart-tab {
            padding: 4px 12px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
        }

        .chart-tab.active {
            background: rgba(255, 255, 255, 0.08);
            color: #ddd;
        }

        /* Doughnut */
        .doughnut-wrap {
            position: relative;
            display: flex;
            justify-content: center;
            padding: 10px 0;
        }

        .doughnut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .doughnut-center-val {
            font-size: 24px;
            font-weight: 800;
            color: #fff;
        }

        .doughnut-center-label {
            font-size: 10px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
        }

        .doughnut-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: #888;
            font-weight: 500;
        }

        .legend-swatch {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }

        /* Location List */
        .loc-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .loc-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loc-row-rank {
            width: 20px;
            font-size: 11px;
            font-weight: 700;
            color: #555;
            text-align: center;
        }

        .loc-row-name {
            width: 100px;
            font-size: 12px;
            color: #bbb;
            font-weight: 500;
        }

        .loc-row-bar-bg {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 3px;
            overflow: hidden;
        }

        .loc-row-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .loc-row-val {
            font-size: 11px;
            color: #888;
            font-weight: 700;
            width: 28px;
            text-align: right;
        }

        /* Heatmap */
        .heatmap-scale {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
            font-size: 10px;
            color: #555;
            font-weight: 600;
        }

        .heatmap-blocks {
            display: flex;
            gap: 3px;
        }

        .heatmap-blocks span {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        /* ===== MESSAGES ===== */
        .messages-layout {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 16px;
        }

        @media (max-width: 900px) {
            .messages-layout {
                grid-template-columns: 1fr;
            }
        }

        .compose-card,
        .templates-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 24px;
        }

        .compose-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .form-select,
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.04);
            color: #fff;
            font-size: 13px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-select:focus,
        .form-input:focus,
        .form-textarea:focus {
            border-color: #3b82f6;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-select option {
            background: #1a1a2e;
            color: #fff;
        }

        .send-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: #fff;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.4);
        }

        .template-btn {
            display: flex;
            align-items: center;
            gap: 14px;
            width: 100%;
            padding: 14px 16px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
            text-align: left;
            font-family: inherit;
        }

        .template-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .template-icon {
            font-size: 24px;
        }

        .template-name {
            font-size: 13px;
            font-weight: 600;
            color: #ddd;
        }

        .template-desc {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .empty-state {
            padding: 32px;
            text-align: center;
            color: #555;
            font-size: 13px;
        }

        /* Sent message card */
        .sent-msg-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 10px;
        }

        .sent-msg-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .sent-msg-subject {
            font-size: 14px;
            font-weight: 700;
        }

        .sent-msg-time {
            font-size: 11px;
            color: #666;
        }

        .sent-msg-recipient {
            font-size: 12px;
            color: #60a5fa;
            margin-bottom: 6px;
        }

        .sent-msg-body {
            font-size: 12px;
            color: #888;
            line-height: 1.5;
        }

        /* ===== USERS TABLE ===== */
        .users-table-wrap {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .users-table th {
            text-align: left;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.04);
            font-size: 11px;
            font-weight: 700;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .users-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            color: #ccc;
        }

        .users-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .role-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }

        .role-badge.admin {
            background: rgba(37, 99, 235, 0.15);
            color: #60a5fa;
        }

        .role-badge.user {
            background: rgba(255, 255, 255, 0.06);
            color: #888;
        }

        /* ===== ACTIVITY LOG ===== */
        .activity-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 14px 16px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.04);
            transition: background 0.2s;
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 16px;
        }

        .activity-icon.approval {
            background: rgba(34, 197, 94, 0.15);
        }

        .activity-icon.claim {
            background: rgba(37, 99, 235, 0.15);
        }

        .activity-icon.message {
            background: rgba(168, 85, 247, 0.15);
        }

        .activity-icon.system {
            background: rgba(245, 158, 11, 0.15);
        }

        .activity-content {
            flex: 1;
        }

        .activity-desc {
            font-size: 13px;
            color: #ccc;
            font-weight: 500;
        }

        .activity-desc strong {
            color: #fff;
        }

        .activity-meta {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
    </style>
    <link rel="stylesheet" href="css/theme.css">
</head>

<body>
    <nav>
        <a class="nav-left" href="index.html"><span class="brand-logo">
                <img class="logo-dark" src="logo.png" alt="BackTrack">
                <img class="logo-light" src="logo-white.png" alt="" aria-hidden="true">
            </span></a>
        <div class="nav-center">
            <a class="nav-link" href="browse.html">Browse</a>
            <a class="nav-link" href="map.html">Map</a>
            <a class="nav-link" href="submit.html">Submit</a>
            <a class="nav-link" href="features.html">Features</a>
            <a class="nav-link" href="sources.html">Sources</a>
        </div>
        <div class="nav-right">
            <a class="sign-in-btn" href="login.html">Sign In</a>
        </div>
    </nav>
    <div class="nav-spacer"></div>

    <!-- Mobile Tabs (visible on small screens) -->
    <div class="mobile-tabs">
        <button class="mobile-tab active" data-panel="dashboard">Dashboard</button>
        <button class="mobile-tab" data-panel="submissions">Submissions</button>
        <button class="mobile-tab" data-panel="claims">Claims</button>
        <button class="mobile-tab" data-panel="bounties">Bounties</button>
        <button class="mobile-tab" data-panel="map">Map</button>
        <button class="mobile-tab" data-panel="analytics">Analytics</button>
        <button class="mobile-tab" data-panel="messages">Messages</button>
        <button class="mobile-tab" data-panel="users">Users</button>
        <button class="mobile-tab" data-panel="activity">Activity</button>
    </div>

    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-label">Overview</div>
            <div class="sidebar-nav">
                <button class="sidebar-link active" data-panel="dashboard">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg></span> Dashboard
                </button>
            </div>

            <div class="sidebar-label">Manage</div>
            <div class="sidebar-nav">
                <button class="sidebar-link" data-panel="submissions">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                            <line x1="12" y1="22.08" x2="12" y2="12" />
                        </svg></span> Submissions
                    <span class="link-badge" id="sidebarItemsBadge">0</span>
                </button>
                <button class="sidebar-link" data-panel="claims">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg></span> Claims
                    <span class="link-badge" id="sidebarClaimsBadge">0</span>
                </button>
                <button class="sidebar-link" data-panel="bounties">
                    <span class="link-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <path d="M21 21l-4.35-4.35" />
                        </svg>
                    </span> Bounties
                    <span class="link-badge" id="sidebarBountiesBadge">0</span>
                </button>
                <button class="sidebar-link" data-panel="users">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg></span> Users
                </button>
            </div>

            <div class="sidebar-label">Tools</div>
            <div class="sidebar-nav">
                <button class="sidebar-link" data-panel="map">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" />
                            <line x1="8" y1="2" x2="8" y2="18" />
                            <line x1="16" y1="6" x2="16" y2="22" />
                        </svg></span> Map Items
                    <span class="link-badge" id="sidebarMapBadge">0</span>
                </button>
                <button class="sidebar-link" data-panel="analytics">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10" />
                            <line x1="12" y1="20" x2="12" y2="4" />
                            <line x1="6" y1="20" x2="6" y2="14" />
                        </svg></span> Analytics
                </button>
                <button class="sidebar-link" data-panel="messages">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg></span> Messages
                </button>
                <button class="sidebar-link" data-panel="activity">
                    <span class="link-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg></span> Activity Log
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="admin-main">
            <div class="admin-status" id="adminStatus"></div>

            <!-- Dashboard Panel -->
            <div class="admin-panel active" id="panel-dashboard">
                <div class="dash-header-row">
                    <div>
                        <h1 class="admin-main-title">Dashboard</h1>
                        <p class="admin-main-desc" id="dashGreeting">Overview — <span id="dashDate"></span></p>
                    </div>
                    <div class="dash-header-actions">
                        <button class="dash-export-btn" onclick="alert('Report exported.')">Export Report</button>
                    </div>
                </div>

                <div class="dash-stats" id="dashStats">
                    <div class="dash-kpi">
                        <div class="kpi-top">
                            <span class="kpi-label">Pending Items</span>
                            <canvas class="kpi-spark" id="sparkPending" width="64" height="28"></canvas>
                        </div>
                        <div class="kpi-value" id="pendingCount">0</div>
                        <div class="kpi-sub">Awaiting review</div>
                    </div>
                    <div class="dash-kpi">
                        <div class="kpi-top">
                            <span class="kpi-label">Active Claims</span>
                            <canvas class="kpi-spark" id="sparkClaims" width="64" height="28"></canvas>
                        </div>
                        <div class="kpi-value" id="claimsCount">0</div>
                        <div class="kpi-sub">Need verification</div>
                    </div>
                    <div class="dash-kpi">
                        <div class="kpi-top">
                            <span class="kpi-label">Open Bounties</span>
                            <canvas class="kpi-spark" id="sparkBounties" width="64" height="28"></canvas>
                        </div>
                        <div class="kpi-value" id="bountiesCount">0</div>
                        <div class="kpi-sub">Students searching</div>
                    </div>
                    <div class="dash-kpi">
                        <div class="kpi-top">
                            <span class="kpi-label">Recovery Rate</span>
                            <span class="kpi-badge positive">+5%</span>
                        </div>
                        <div class="kpi-value">68<span class="kpi-unit">%</span></div>
                        <div class="kpi-sub">Last 30 days</div>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="dash-chart-wrap">
                    <div class="dash-chart-header">
                        <div>
                            <div class="dash-chart-title">Item Submissions</div>
                            <div class="dash-chart-subtitle">Last 30 days — found vs claimed</div>
                        </div>
                        <div class="dash-chart-legend">
                            <span class="legend-dot" style="background:#3b82f6"></span> Found
                            <span class="legend-dot" style="background:#22c55e;margin-left:12px"></span> Claimed
                        </div>
                    </div>
                    <canvas id="dashTrendChart" width="800" height="200"></canvas>
                </div>

                <!-- Bottom Row: Recent Activity + Quick Actions -->
                <div class="dash-bottom-grid">
                    <div class="dash-recent-card">
                        <div class="dash-card-header">
                            <span class="dash-card-title">Recent Activity</span>
                            <button class="dash-card-link" onclick="switchPanel('activity')">View all →</button>
                        </div>
                        <div class="dash-recent-list" id="dashRecentList"></div>
                    </div>
                    <div class="dash-actions-card">
                        <div class="dash-card-header">
                            <span class="dash-card-title">Quick Actions</span>
                        </div>
                        <div class="dash-qa-grid">
                            <button class="dash-qa" onclick="switchPanel('submissions')">
                                <span class="qa-icon" style="color:#f59e0b">⬡</span>
                                <span class="qa-text">Review Submissions</span>
                                <span class="qa-count" id="qaSubmissions">0</span>
                            </button>
                            <button class="dash-qa" onclick="switchPanel('claims')">
                                <span class="qa-icon" style="color:#818cf8">⊙</span>
                                <span class="qa-text">Verify Claims</span>
                                <span class="qa-count" id="qaClaims">0</span>
                            </button>
                            <button class="dash-qa" onclick="switchPanel('bounties')">
                                <span class="qa-icon" style="color:#ec4899">⊕</span>
                                <span class="qa-text">Manage Bounties</span>
                                <span class="qa-count" id="qaBounties">0</span>
                            </button>
                            <button class="dash-qa" onclick="switchPanel('map')">
                                <span class="qa-icon" style="color:#22c55e">◈</span>
                                <span class="qa-text">Map Items</span>
                                <span class="qa-count" id="qaMap">11</span>
                            </button>
                            <button class="dash-qa" onclick="switchPanel('messages')">
                                <span class="qa-icon" style="color:#60a5fa">▣</span>
                                <span class="qa-text">Send Message</span>
                            </button>
                            <button class="dash-qa" onclick="switchPanel('analytics')">
                                <span class="qa-icon" style="color:#a78bfa">◧</span>
                                <span class="qa-text">View Analytics</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submissions Panel -->
            <div class="admin-panel" id="panel-submissions">
                <h1 class="admin-main-title">Pending Submissions</h1>
                <p class="admin-main-desc">Review and approve found item reports</p>
                <div class="section-header">
                    <h2 class="section-title">Items</h2>
                    <span class="section-count" id="itemsCountBadge">0</span>
                </div>
                <div class="cards-list" id="pendingItems">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Claims Panel -->
            <div class="admin-panel" id="panel-claims">
                <h1 class="admin-main-title">Pending Claims</h1>
                <p class="admin-main-desc">Verify ownership claims from students</p>
                <div class="section-header">
                    <h2 class="section-title">Claims</h2>
                    <span class="section-count" id="claimsCountBadge">0</span>
                </div>
                <div class="cards-list" id="pendingClaims">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Bounties Panel -->
            <div class="admin-panel" id="panel-bounties">
                <h1 class="admin-main-title">Active Bounties</h1>
                <p class="admin-main-desc">Manage lost item bounty posts from students</p>
                <div class="section-header">
                    <h2 class="section-title">Bounties</h2>
                    <span class="section-count" id="bountiesCountBadge">0</span>
                </div>
                <div class="cards-list" id="bountyItems">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Map Panel -->
            <div class="admin-panel" id="panel-map">
                <h1 class="admin-main-title">Map Items</h1>
                <p class="admin-main-desc">Manage items pinned to the school map</p>
                <div class="section-header">
                    <h2 class="section-title">Items on Map</h2>
                    <span class="section-count" id="mapItemsCountBadge">0</span>
                </div>
                <div class="filter-bar">
                    <button class="filter-btn active" onclick="filterMapItems('all')">All Floors</button>
                    <button class="filter-btn" onclick="filterMapItems(1)">Floor 1</button>
                    <button class="filter-btn" onclick="filterMapItems(2)">Floor 2</button>
                </div>
                <div class="cards-list" id="mapItems"></div>
            </div>

            <!-- Analytics Panel -->
            <div class="admin-panel" id="panel-analytics">
                <div class="dash-header-row">
                    <div>
                        <h1 class="admin-main-title">Analytics</h1>
                        <p class="admin-main-desc">Performance overview — last 30 days</p>
                    </div>
                    <div class="dash-header-actions">
                        <select class="analytics-range-select" id="analyticsRange">
                            <option value="30">Last 30 days</option>
                            <option value="7">Last 7 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>
                </div>

                <!-- Metric Strip -->
                <div class="metric-strip">
                    <div class="metric-item">
                        <div class="metric-value">156</div>
                        <div class="metric-label">Total Items</div>
                        <div class="metric-change positive">↑ 12%</div>
                    </div>
                    <div class="metric-divider"></div>
                    <div class="metric-item">
                        <div class="metric-value">23</div>
                        <div class="metric-label">This Week</div>
                        <div class="metric-change positive">↑ 8</div>
                    </div>
                    <div class="metric-divider"></div>
                    <div class="metric-item">
                        <div class="metric-value">68%</div>
                        <div class="metric-label">Recovery Rate</div>
                        <div class="metric-change positive">↑ 5%</div>
                    </div>
                    <div class="metric-divider"></div>
                    <div class="metric-item">
                        <div class="metric-value">2.3d</div>
                        <div class="metric-label">Avg Resolution</div>
                        <div class="metric-change negative">↓ 0.5d</div>
                    </div>
                    <div class="metric-divider"></div>
                    <div class="metric-item">
                        <div class="metric-value">247</div>
                        <div class="metric-label">Active Users</div>
                        <div class="metric-change positive">↑ 18</div>
                    </div>
                </div>

                <!-- Charts Row 1: Line Chart + Doughnut -->
                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div class="chart-card-title">Weekly Submissions</div>
                            <div class="chart-card-tabs">
                                <button class="chart-tab active">Found</button>
                                <button class="chart-tab">Claimed</button>
                            </div>
                        </div>
                        <canvas id="analyticsLineChart" height="220"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div class="chart-card-title">Category Distribution</div>
                        </div>
                        <div class="doughnut-wrap">
                            <canvas id="analyticsDoughnut" width="200" height="200"></canvas>
                            <div class="doughnut-center">
                                <div class="doughnut-center-val">156</div>
                                <div class="doughnut-center-label">Total</div>
                            </div>
                        </div>
                        <div class="doughnut-legend" id="doughnutLegend"></div>
                    </div>
                </div>

                <!-- Charts Row 2: Locations + Heatmap -->
                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div class="chart-card-title">Top Locations</div>
                            <div class="chart-card-subtitle">Where items are found most</div>
                        </div>
                        <div class="loc-list" id="analyticsLocations"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div class="chart-card-title">Activity Heatmap</div>
                            <div class="chart-card-subtitle">Reports by day and hour</div>
                        </div>
                        <canvas id="analyticsHeatmap" height="180"></canvas>
                        <div class="heatmap-scale">
                            <span>Less</span>
                            <div class="heatmap-blocks">
                                <span style="background:rgba(59,130,246,0.08)"></span>
                                <span style="background:rgba(59,130,246,0.2)"></span>
                                <span style="background:rgba(59,130,246,0.4)"></span>
                                <span style="background:rgba(59,130,246,0.65)"></span>
                                <span style="background:#3b82f6"></span>
                            </div>
                            <span>More</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Messages Panel -->
            <div class="admin-panel" id="panel-messages">
                <h1 class="admin-main-title">Messages</h1>
                <p class="admin-main-desc">Send announcements and notifications to students</p>

                <div class="messages-layout">
                    <div class="compose-card">
                        <h3 class="compose-title">Compose Message</h3>
                        <div class="form-group">
                            <label class="form-label">Recipient</label>
                            <select class="form-select" id="msgRecipient">
                                <option value="all">All Students</option>
                                <option value="denmark">Denmark High School</option>
                                <option value="alliance">Alliance Academy</option>
                                <option value="south">South Forsyth</option>
                                <option value="individual">Individual Student</option>
                            </select>
                        </div>
                        <div class="form-group" id="individualEmailGroup" style="display:none">
                            <label class="form-label">Student Email</label>
                            <input type="email" class="form-input" id="msgEmail" placeholder="student@school.edu">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <input type="text" class="form-input" id="msgSubject" placeholder="Enter subject line...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea class="form-textarea" id="msgBody" rows="5"
                                placeholder="Write your message here..."></textarea>
                        </div>
                        <button class="send-btn" onclick="sendMessage()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13" />
                                <polygon points="22 2 15 22 11 13 2 9 22 2" />
                            </svg>
                            Send Message
                        </button>
                    </div>
                    <div class="templates-card">
                        <h3 class="compose-title">Quick Templates</h3>
                        <button class="template-btn" onclick="useTemplate('new_items')">
                            <span class="template-icon">📦</span>
                            <div>
                                <div class="template-name">New Items Found</div>
                                <div class="template-desc">Notify about newly found items today</div>
                            </div>
                        </button>
                        <button class="template-btn" onclick="useTemplate('claim_reminder')">
                            <span class="template-icon">⏰</span>
                            <div>
                                <div class="template-name">Claim Reminder</div>
                                <div class="template-desc">Remind students to check their claims</div>
                            </div>
                        </button>
                        <button class="template-btn" onclick="useTemplate('office_hours')">
                            <span class="template-icon">🏫</span>
                            <div>
                                <div class="template-name">Office Hours Update</div>
                                <div class="template-desc">Share lost & found office hours</div>
                            </div>
                        </button>
                        <button class="template-btn" onclick="useTemplate('weekly_digest')">
                            <span class="template-icon">📊</span>
                            <div>
                                <div class="template-name">Weekly Digest</div>
                                <div class="template-desc">Weekly summary of activity</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="section-header" style="margin-top:24px">
                    <h2 class="section-title">Sent Messages</h2>
                    <span class="section-count" id="sentMsgCount">0</span>
                </div>
                <div class="cards-list" id="sentMessagesList">
                    <div class="empty-state">No messages sent yet</div>
                </div>
            </div>

            <!-- Users Panel -->
            <div class="admin-panel" id="panel-users">
                <h1 class="admin-main-title">User Management</h1>
                <p class="admin-main-desc">View and manage registered users</p>

                <div class="analytics-stats-row">
                    <div class="analytics-stat-card">
                        <div class="stat-card-icon" style="background:rgba(37,99,235,0.15);color:#60a5fa">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                        </div>
                        <div class="stat-card-label">Total Users</div>
                        <div class="stat-card-value">247</div>
                    </div>
                    <div class="analytics-stat-card">
                        <div class="stat-card-icon" style="background:rgba(34,197,94,0.15);color:#4ade80">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M12 6v6l4 2" />
                            </svg>
                        </div>
                        <div class="stat-card-label">Active Today</div>
                        <div class="stat-card-value">34</div>
                    </div>
                    <div class="analytics-stat-card">
                        <div class="stat-card-icon" style="background:rgba(245,158,11,0.15);color:#fbbf24">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="8.5" cy="7" r="4" />
                                <line x1="20" y1="8" x2="20" y2="14" />
                                <line x1="23" y1="11" x2="17" y2="11" />
                            </svg>
                        </div>
                        <div class="stat-card-label">New This Week</div>
                        <div class="stat-card-value">12</div>
                    </div>
                </div>

                <div class="section-header" style="margin-top:24px">
                    <h2 class="section-title">All Users</h2>
                    <span class="section-count">247</span>
                </div>
                <div class="users-table-wrap">
                    <table class="users-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>School</th>
                                <th>Items</th>
                                <th>Claims</th>
                                <th>Joined</th>
                                <th>Role</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Activity Log Panel -->
            <div class="admin-panel" id="panel-activity">
                <h1 class="admin-main-title">Activity Log</h1>
                <p class="admin-main-desc">Chronological feed of all admin actions</p>

                <div class="activity-filters">
                    <button class="filter-btn active" onclick="filterActivity('all')">All</button>
                    <button class="filter-btn" onclick="filterActivity('approval')">Approvals</button>
                    <button class="filter-btn" onclick="filterActivity('claim')">Claims</button>
                    <button class="filter-btn" onclick="filterActivity('message')">Messages</button>
                    <button class="filter-btn" onclick="filterActivity('system')">System</button>
                </div>

                <div class="activity-feed" id="activityFeed"></div>
            </div>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script>
        // ==========================================
        // PANEL NAVIGATION
        // ==========================================
        function switchPanel(name) {
            // Update panels
            document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
            const panel = document.getElementById('panel-' + name);
            if (panel) panel.classList.add('active');

            // Update sidebar
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            const link = document.querySelector(`.sidebar-link[data-panel="${name}"]`);
            if (link) link.classList.add('active');

            // Update mobile tabs
            document.querySelectorAll('.mobile-tab').forEach(t => t.classList.remove('active'));
            const tab = document.querySelector(`.mobile-tab[data-panel="${name}"]`);
            if (tab) tab.classList.add('active');
        }

        // Sidebar clicks
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => switchPanel(link.dataset.panel));
        });

        // Mobile tab clicks
        document.querySelectorAll('.mobile-tab').forEach(tab => {
            tab.addEventListener('click', () => switchPanel(tab.dataset.panel));
        });

        // ==========================================
        // ADMIN DATA
        // ==========================================
        const pendingItemsEl = document.getElementById('pendingItems');
        const pendingClaimsEl = document.getElementById('pendingClaims');
        const bountyItemsEl = document.getElementById('bountyItems');
        const adminStatus = document.getElementById('adminStatus');
        const dashStats = document.getElementById('dashStats');

        function showStatus(msg) {
            adminStatus.textContent = msg;
            adminStatus.classList.toggle('visible', !!msg);
        }

        function renderEmpty(container, text) {
            container.innerHTML = `<div class="empty-state"><p>${text}</p></div>`;
        }

        async function loadAdminData() {
            if (typeof BackTrackDB === 'undefined') {
                showStatus('Supabase is not configured.');
                return;
            }

            const user = await BackTrackDB.getCurrentUser();
            const isAdmin = await BackTrackDB.isAdmin();
            const isSuperAdmin = user?.email === 'rushwanthmahendran1@gmail.com';

            if (!isAdmin && !isSuperAdmin) {
                showStatus('Admin access required. Sign in with an admin account.');
                return;
            }

            showStatus('');
            dashStats.style.display = 'grid';

            const [items, claims] = await Promise.all([
                BackTrackDB.getPendingItems(),
                BackTrackDB.getPendingClaims()
            ]);

            // Get bounties
            let bounties = [];
            try {
                bounties = await BackTrackDB.getItems({ status: ['bounty'] });
            } catch (e) { console.log('No bounties table or column', e); }

            let totalActive = 0;
            try {
                const all = await BackTrackDB.getItems({ status: ['found', 'claimed'] });
                totalActive = all.length;
            } catch (e) { }

            // Update all counts
            document.getElementById('pendingCount').textContent = items.length;
            document.getElementById('claimsCount').textContent = claims.length;
            document.getElementById('bountiesCount').textContent = bounties.length;
            document.getElementById('totalCount').textContent = totalActive;
            document.getElementById('itemsCountBadge').textContent = items.length;
            document.getElementById('claimsCountBadge').textContent = claims.length;
            document.getElementById('bountiesCountBadge').textContent = bounties.length;
            document.getElementById('sidebarItemsBadge').textContent = items.length;
            document.getElementById('sidebarClaimsBadge').textContent = claims.length;
            document.getElementById('sidebarBountiesBadge').textContent = bounties.length;

            // Render Pending Items
            if (!items.length) {
                renderEmpty(pendingItemsEl, 'No pending submissions. All caught up! ');
            } else {
                pendingItemsEl.innerHTML = items.map(item => `
                    <div class="review-card" id="item-card-${item.id}">
                        <div class="card-top">
                            <div class="card-info">
                                <div class="card-title">${item.name}</div>
                                <div class="card-meta">
                                    ${item.category} &middot; ${item.location} &middot; ${item.date_lost || 'No date'}
                                </div>
                                <div class="card-meta">Contact: ${item.contact_email || 'N/A'}${item.contact_phone ? ' &middot; ' + item.contact_phone : ''}</div>
                                ${item.description ? `<div class="card-proof">${item.description}</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-approve" onclick="approveItem('${item.id}')">Approve</button>
                                <button class="btn btn-reject" onclick="rejectItem('${item.id}')">Reject</button>
                            </div>
                        </div>
                        <div class="card-status" id="item-status-${item.id}"></div>
                    </div>
                `).join('');
            }

            // Render Pending Claims
            if (!claims.length) {
                renderEmpty(pendingClaimsEl, 'No pending claims to review.');
            } else {
                pendingClaimsEl.innerHTML = claims.map(claim => `
                    <div class="review-card" id="claim-card-${claim.id}">
                        <div class="card-top">
                            <div class="card-info">
                                <div class="card-title">${claim.items?.name || 'Unknown Item'}</div>
                                <div class="card-meta">
                                    ${claim.items?.category || 'N/A'} &middot; ${claim.items?.location || 'N/A'}
                                </div>
                                <div class="card-meta">Claimed by: <strong style="color:#ccc">${claim.claimer_name || 'Unknown'}</strong> (${claim.claimer_email})</div>
                                ${claim.proof_description ? `<div class="card-proof"><strong>Proof:</strong> ${claim.proof_description}</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-approve" onclick="approveClaim('${claim.id}', '${claim.item_id}')">Approve</button>
                                <button class="btn btn-reject" onclick="rejectClaim('${claim.id}')">Reject</button>
                            </div>
                        </div>
                        <div class="card-status" id="claim-status-${claim.id}"></div>
                    </div>
                `).join('');
            }

            // Render Bounties
            if (!bounties.length) {
                renderEmpty(bountyItemsEl, 'No active bounties.');
            } else {
                bountyItemsEl.innerHTML = bounties.map(b => `
                    <div class="review-card" id="bounty-card-${b.id}">
                        <div class="card-top">
                            <div class="card-info">
                                <div class="card-title">${b.name}
                                    ${b.urgency ? `<span class="urgency-badge urgency-${b.urgency}">${b.urgency}</span>` : ''}
                                </div>
                                <div class="card-meta">
                                    ${b.category || 'N/A'} &middot; Last seen: ${b.location || 'N/A'} &middot; ${b.date_lost || 'No date'}
                                </div>
                                <div class="card-meta">Posted by: ${b.contact_email || 'N/A'}${b.contact_phone ? ' &middot; ' + b.contact_phone : ''}</div>
                                ${b.description ? `<div class="card-proof">${b.description}</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-reject" onclick="removeBounty('${b.id}')">Remove</button>
                            </div>
                        </div>
                        <div class="card-status" id="bounty-status-${b.id}"></div>
                    </div>
                `).join('');
            }
        }

        // ==========================================
        // ITEM ACTIONS
        // ==========================================
        async function approveItem(id) {
            const s = document.getElementById(`item-status-${id}`);
            s.textContent = 'Approving...'; s.className = 'card-status';
            const ok = await BackTrackDB.setItemStatus(id, 'found');
            if (ok) { s.textContent = 'Approved.'; setTimeout(loadAdminData, 800); }
            else { s.textContent = 'Failed.'; s.className = 'card-status error'; }
        }

        async function rejectItem(id) {
            if (!confirm('Remove this submission?')) return;
            const s = document.getElementById(`item-status-${id}`);
            s.textContent = 'Removing...';
            const ok = await BackTrackDB.deleteItem(id);
            if (ok) { s.textContent = 'Removed.'; setTimeout(loadAdminData, 800); }
            else { s.textContent = 'Failed.'; s.className = 'card-status error'; }
        }

        async function approveClaim(claimId, itemId) {
            const s = document.getElementById(`claim-status-${claimId}`);
            s.textContent = 'Approving...'; s.className = 'card-status';
            const claim = await BackTrackDB.updateClaimStatus(claimId, 'approved');
            if (claim && itemId) {
                await BackTrackDB.setItemStatus(itemId, 'claimed');
                s.textContent = 'Approved. Item marked claimed.';
                setTimeout(loadAdminData, 800);
            } else { s.textContent = 'Failed.'; s.className = 'card-status error'; }
        }

        async function rejectClaim(claimId) {
            if (!confirm('Reject this claim?')) return;
            const s = document.getElementById(`claim-status-${claimId}`);
            s.textContent = 'Rejecting...';
            const ok = await BackTrackDB.updateClaimStatus(claimId, 'rejected');
            if (ok) { s.textContent = 'Rejected.'; setTimeout(loadAdminData, 800); }
            else { s.textContent = 'Failed.'; s.className = 'card-status error'; }
        }

        async function removeBounty(id) {
            if (!confirm('Remove this bounty?')) return;
            const s = document.getElementById(`bounty-status-${id}`);
            s.textContent = 'Removing...';
            const ok = await BackTrackDB.deleteItem(id);
            if (ok) { s.textContent = 'Removed.'; setTimeout(loadAdminData, 800); }
            else { s.textContent = 'Failed.'; s.className = 'card-status error'; }
        }

        // ==========================================
        // MAP ITEMS
        // ==========================================
        const mapData = {
            1: {
                rooms: [
                    { id: "F1-101", name: "Main Office", items: [{ name: "Black Wallet", desc: "Found near reception desk" }] },
                    { id: "F1-102", name: "Cafeteria", items: [{ name: "Lunch Box", desc: "Red with superhero stickers" }] },
                    { id: "F1-103", name: "Gymnasium", items: [{ name: "Water Bottle", desc: "Blue Hydro Flask" }, { name: "AirPods", desc: "White case" }] },
                    { id: "F1-104", name: "Hallway", items: [{ name: "Textbook", desc: "AP Chemistry" }] },
                    { id: "F1-105", name: "Health Clinic", items: [{ name: "Jacket", desc: "Nike gray hoodie size M" }] },
                    { id: "F1-106", name: "Auditorium", items: [] },
                    { id: "F1-107", name: "Library Entrance", items: [] },
                ],
            },
            2: {
                rooms: [
                    { id: "F2-201", name: "Biology Lab", items: [{ name: "Lab Goggles", desc: "Clear safety goggles" }] },
                    { id: "F2-202", name: "Library", items: [{ name: "Calculator", desc: "TI-84 Plus" }, { name: "Earbuds", desc: "Samsung Galaxy Buds" }] },
                    { id: "F2-203", name: "Computer Lab", items: [{ name: "USB Drive", desc: "32GB SanDisk" }] },
                    { id: "F2-204", name: "Classroom A", items: [] },
                    { id: "F2-205", name: "Hallway", items: [] },
                    { id: "F2-206", name: "Chemistry Lab", items: [] },
                    { id: "F2-207", name: "Classroom B", items: [{ name: "Backpack", desc: "Black Jansport" }] },
                    { id: "F2-208", name: "Classroom C", items: [] },
                    { id: "F2-209", name: "Teacher Lounge", items: [] },
                ],
            },
        };

        let currentFilter = 'all';

        function getAllMapItems() {
            const items = [];
            Object.entries(mapData).forEach(([floor, data]) => {
                data.rooms.forEach(room => {
                    room.items.forEach((item, idx) => {
                        items.push({
                            id: `${room.id}-${idx}`,
                            floor: parseInt(floor),
                            room: room.name,
                            roomId: room.id,
                            itemIndex: idx,
                            ...item
                        });
                    });
                });
            });
            return items;
        }

        function filterMapItems(filter) {
            currentFilter = filter;
            // Update filter button styles
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            loadMapItems();
        }

        function loadMapItems() {
            const mapItemsEl = document.getElementById('mapItems');
            let items = getAllMapItems();

            if (currentFilter !== 'all') {
                items = items.filter(item => item.floor === currentFilter);
            }

            document.getElementById('mapItemsCountBadge').textContent = items.length;
            document.getElementById('sidebarMapBadge').textContent = items.length;

            if (items.length === 0) {
                mapItemsEl.innerHTML = '<div class="empty-state"><p>No map items found.</p></div>';
                return;
            }

            mapItemsEl.innerHTML = items.map(item => `
                <div class="review-card" id="mapitem-${item.id}">
                    <div class="card-top">
                        <div class="card-info">
                            <div class="card-title">${item.name}</div>
                            <div class="card-meta">
                                Floor ${item.floor} &middot; ${item.room}
                            </div>
                            ${item.desc ? `<div class="card-proof">${item.desc}</div>` : ''}
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-reject" onclick="removeMapItem('${item.id}', ${item.floor}, '${item.roomId}', ${item.itemIndex})">Remove</button>
                        </div>
                    </div>
                    <div class="card-status" id="mapitem-status-${item.id}"></div>
                </div>
            `).join('');
        }

        function removeMapItem(id, floor, roomId, itemIndex) {
            if (!confirm('Remove this item from the map?')) return;

            const statusEl = document.getElementById(`mapitem-status-${id}`);
            statusEl.textContent = 'Removing...';
            statusEl.className = 'card-status';

            const room = mapData[floor].rooms.find(r => r.id === roomId);
            if (room && room.items[itemIndex]) {
                room.items.splice(itemIndex, 1);
                statusEl.textContent = 'Removed successfully.';
                setTimeout(() => {
                    loadMapItems();
                }, 800);
            } else {
                statusEl.textContent = 'Error removing item.';
                statusEl.className = 'card-status error';
            }
        }

        // ==========================================
        // MESSAGES
        // ==========================================
        const sentMessages = [];

        document.getElementById('msgRecipient')?.addEventListener('change', function () {
            const emailGroup = document.getElementById('individualEmailGroup');
            emailGroup.style.display = this.value === 'individual' ? 'block' : 'none';
        });

        function useTemplate(type) {
            const templates = {
                new_items: {
                    subject: 'New Items Found Today!',
                    body: 'Hello! New lost items have been turned in today. Please visit the BackTrack website or the Lost & Found office to check if any of them belong to you. Browse items at backtrack.app/browse'
                },
                claim_reminder: {
                    subject: 'Reminder: Check Your Pending Claims',
                    body: 'This is a friendly reminder to check on your pending claims. If you have submitted a claim, please visit the front office to verify and pick up your item. Unclaimed items will be donated after 30 days.'
                },
                office_hours: {
                    subject: 'Lost & Found Office Hours Update',
                    body: 'The Lost & Found office is open:\n• Monday–Friday: 7:30 AM – 3:30 PM\n• Located in the Main Office, Room 100\n\nPlease bring your student ID when claiming items.'
                },
                weekly_digest: {
                    subject: 'Weekly Lost & Found Digest',
                    body: 'Here is your weekly summary:\n• New items this week: 23\n• Items claimed: 15\n• Recovery rate: 68%\n\nMost common locations: Cafeteria, Gymnasium, Media Center. Remember to label your belongings!'
                }
            };
            const t = templates[type];
            if (t) {
                document.getElementById('msgSubject').value = t.subject;
                document.getElementById('msgBody').value = t.body;
            }
        }

        function sendMessage() {
            const recipient = document.getElementById('msgRecipient').value;
            const subject = document.getElementById('msgSubject').value.trim();
            const body = document.getElementById('msgBody').value.trim();
            const email = document.getElementById('msgEmail')?.value.trim();

            if (!subject || !body) {
                alert('Please fill in subject and message.');
                return;
            }
            if (recipient === 'individual' && !email) {
                alert('Please enter the student email.');
                return;
            }

            const recipientLabels = {
                all: 'All Students',
                denmark: 'Denmark High School',
                alliance: 'Alliance Academy',
                south: 'South Forsyth',
                individual: email
            };

            const msg = {
                recipient: recipientLabels[recipient],
                subject,
                body,
                time: new Date().toLocaleString()
            };
            sentMessages.unshift(msg);
            renderSentMessages();

            // Clear form
            document.getElementById('msgSubject').value = '';
            document.getElementById('msgBody').value = '';
            document.getElementById('msgEmail').value = '';

            // Add to activity log
            activityData.unshift({
                type: 'message',
                icon: '💬',
                desc: `Message sent to <strong>${msg.recipient}</strong>: "${msg.subject}"`,
                time: 'Just now'
            });
            renderActivity('all');
        }

        function renderSentMessages() {
            const list = document.getElementById('sentMessagesList');
            document.getElementById('sentMsgCount').textContent = sentMessages.length;
            if (sentMessages.length === 0) {
                list.innerHTML = '<div class="empty-state">No messages sent yet</div>';
                return;
            }
            list.innerHTML = sentMessages.map(m => `
                <div class="sent-msg-card">
                    <div class="sent-msg-header">
                        <div class="sent-msg-subject">${m.subject}</div>
                        <div class="sent-msg-time">${m.time}</div>
                    </div>
                    <div class="sent-msg-recipient">To: ${m.recipient}</div>
                    <div class="sent-msg-body">${m.body.replace(/\n/g, '<br>')}</div>
                </div>
            `).join('');
        }

        // ==========================================
        // USERS TABLE
        // ==========================================
        const demoUsers = [
            { name: 'Sarah Chen', email: 'schen@denmark.edu', school: 'Denmark HS', items: 8, claims: 3, joined: 'Jan 2025', role: 'admin' },
            { name: 'Marcus Johnson', email: 'mjohnson@denmark.edu', school: 'Denmark HS', items: 5, claims: 7, joined: 'Sep 2024', role: 'user' },
            { name: 'Priya Patel', email: 'ppatel@alliance.edu', school: 'Alliance Academy', items: 12, claims: 2, joined: 'Oct 2024', role: 'user' },
            { name: 'Jordan Williams', email: 'jwilliams@south.edu', school: 'South Forsyth', items: 3, claims: 1, joined: 'Nov 2024', role: 'user' },
            { name: 'Emily Rodriguez', email: 'erodriguez@denmark.edu', school: 'Denmark HS', items: 6, claims: 4, joined: 'Aug 2024', role: 'admin' },
            { name: 'Tyler Kim', email: 'tkim@alliance.edu', school: 'Alliance Academy', items: 2, claims: 5, joined: 'Dec 2024', role: 'user' },
            { name: 'Aisha Thompson', email: 'athompson@denmark.edu', school: 'Denmark HS', items: 9, claims: 6, joined: 'Sep 2024', role: 'user' },
            { name: 'David Lee', email: 'dlee@south.edu', school: 'South Forsyth', items: 4, claims: 2, joined: 'Jan 2025', role: 'user' },
            { name: 'Sofia Martinez', email: 'smartinez@denmark.edu', school: 'Denmark HS', items: 7, claims: 3, joined: 'Oct 2024', role: 'user' },
            { name: 'Ryan O\'Brien', email: 'robrien@alliance.edu', school: 'Alliance Academy', items: 1, claims: 8, joined: 'Nov 2024', role: 'user' }
        ];

        function renderUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;
            tbody.innerHTML = demoUsers.map(u => `
                <tr>
                    <td><strong>${u.name}</strong></td>
                    <td style="color:#888">${u.email}</td>
                    <td>${u.school}</td>
                    <td>${u.items}</td>
                    <td>${u.claims}</td>
                    <td style="color:#888">${u.joined}</td>
                    <td><span class="role-badge ${u.role}">${u.role}</span></td>
                </tr>
            `).join('');
        }
        renderUsersTable();

        // ==========================================
        // ACTIVITY LOG
        // ==========================================
        const activityData = [
            { type: 'approval', icon: '✅', desc: '<strong>Admin</strong> approved submission <strong>Blue Nike Backpack</strong>', time: '5 min ago' },
            { type: 'claim', icon: '🔑', desc: '<strong>Marcus Johnson</strong> claimed <strong>MacBook Charger</strong> in Cafeteria', time: '18 min ago' },
            { type: 'approval', icon: '✅', desc: '<strong>Admin</strong> approved submission <strong>Water Bottle — Green Hydroflask</strong>', time: '35 min ago' },
            { type: 'message', icon: '💬', desc: 'Announcement sent to <strong>All Students</strong>: "New items found today"', time: '1 hour ago' },
            { type: 'system', icon: '⚙️', desc: 'System auto-archived <strong>3 items</strong> older than 30 days', time: '2 hours ago' },
            { type: 'claim', icon: '🔑', desc: '<strong>Priya Patel</strong> submitted claim for <strong>Calculator TI-84</strong>', time: '3 hours ago' },
            { type: 'approval', icon: '✅', desc: '<strong>Admin</strong> rejected submission due to insufficient proof', time: '4 hours ago' },
            { type: 'claim', icon: '🔑', desc: '<strong>Sarah Chen</strong> verified and picked up <strong>AirPods Pro</strong>', time: '5 hours ago' },
            { type: 'system', icon: '⚙️', desc: 'Daily backup completed. <strong>156 items</strong> in database', time: '6 hours ago' },
            { type: 'message', icon: '💬', desc: 'Weekly digest sent to <strong>Denmark HS</strong> students', time: 'Yesterday' }
        ];

        function renderActivity(filter) {
            const feed = document.getElementById('activityFeed');
            if (!feed) return;
            const filtered = filter === 'all' ? activityData : activityData.filter(a => a.type === filter);
            if (filtered.length === 0) {
                feed.innerHTML = '<div class="empty-state">No activity matching this filter</div>';
                return;
            }
            feed.innerHTML = filtered.map(a => `
                <div class="activity-item" data-type="${a.type}">
                    <div class="activity-icon ${a.type}">${a.icon}</div>
                    <div class="activity-content">
                        <div class="activity-desc">${a.desc}</div>
                        <div class="activity-meta">${a.time}</div>
                    </div>
                </div>
            `).join('');
        }
        renderActivity('all');

        function filterActivity(type) {
            // Update buttons
            document.querySelectorAll('.activity-filters .filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderActivity(type);
        }

        // ==========================================
        // DASHBOARD & ANALYTICS CANVAS CHARTS
        // ==========================================

        function drawSparkline(canvasId, data, color) {
            const c = document.getElementById(canvasId);
            if (!c) return;
            const ctx = c.getContext('2d');
            const w = c.width, h = c.height;
            ctx.clearRect(0, 0, w, h);
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            const step = w / (data.length - 1);
            ctx.beginPath();
            data.forEach((v, i) => {
                const x = i * step;
                const y = h - ((v - min) / range) * (h - 4) - 2;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.strokeStyle = color;
            ctx.lineWidth = 1.5;
            ctx.lineJoin = 'round';
            ctx.stroke();
        }

        function drawDashTrend() {
            const c = document.getElementById('dashTrendChart');
            if (!c) return;
            const ctx = c.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = c.getBoundingClientRect();
            c.width = rect.width * dpr;
            c.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            const w = rect.width, h = rect.height;
            const pad = { t: 10, r: 10, b: 24, l: 32 };
            const cw = w - pad.l - pad.r, ch = h - pad.t - pad.b;

            const found = [5, 8, 6, 12, 9, 14, 11, 18, 15, 7, 10, 13, 16, 8, 20, 17, 12, 9, 15, 22, 18, 11, 14, 19, 25, 21, 16, 13, 23, 19];
            const claimed = [3, 5, 4, 8, 6, 10, 7, 12, 10, 5, 7, 9, 11, 5, 14, 12, 8, 6, 10, 15, 12, 7, 9, 13, 17, 14, 11, 9, 16, 13];
            const days = found.length;
            const max = Math.max(...found, ...claimed);

            // Grid lines
            ctx.strokeStyle = 'rgba(255,255,255,0.04)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.t + (ch / 4) * i;
                ctx.beginPath();
                ctx.moveTo(pad.l, y);
                ctx.lineTo(w - pad.r, y);
                ctx.stroke();
                // Y-axis labels
                ctx.fillStyle = '#444';
                ctx.font = '10px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(max - (max / 4) * i), pad.l - 6, y + 3);
            }

            // X-axis labels
            ctx.fillStyle = '#444';
            ctx.font = '10px Inter';
            ctx.textAlign = 'center';
            [0, 6, 13, 20, 29].forEach(i => {
                const x = pad.l + (i / (days - 1)) * cw;
                ctx.fillText('D' + (i + 1), x, h - 4);
            });

            function drawLine(data, color, fillColor) {
                const step = cw / (days - 1);
                ctx.beginPath();
                data.forEach((v, i) => {
                    const x = pad.l + i * step;
                    const y = pad.t + ch - (v / max) * ch;
                    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                });
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.lineJoin = 'round';
                ctx.stroke();
                // Fill
                const lastX = pad.l + (days - 1) * step;
                ctx.lineTo(lastX, pad.t + ch);
                ctx.lineTo(pad.l, pad.t + ch);
                ctx.closePath();
                const grad = ctx.createLinearGradient(0, pad.t, 0, pad.t + ch);
                grad.addColorStop(0, fillColor);
                grad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = grad;
                ctx.fill();
            }

            drawLine(found, '#3b82f6', 'rgba(59,130,246,0.12)');
            drawLine(claimed, '#22c55e', 'rgba(34,197,94,0.08)');
        }

        function drawAnalyticsLine() {
            const c = document.getElementById('analyticsLineChart');
            if (!c) return;
            const ctx = c.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = c.getBoundingClientRect();
            c.width = rect.width * dpr;
            c.height = 220 * dpr;
            ctx.scale(dpr, dpr);
            const w = rect.width, h = 220;
            const pad = { t: 10, r: 10, b: 28, l: 36 };
            const cw = w - pad.l - pad.r, ch = h - pad.t - pad.b;

            const labels = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6', 'W7', 'W8', 'W9', 'W10', 'W11', 'W12'];
            const data = [12, 19, 15, 28, 22, 35, 29, 38, 32, 45, 41, 48];
            const max = Math.max(...data);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.04)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.t + (ch / 4) * i;
                ctx.beginPath();
                ctx.moveTo(pad.l, y);
                ctx.lineTo(w - pad.r, y);
                ctx.stroke();
                ctx.fillStyle = '#444';
                ctx.font = '10px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(max - (max / 4) * i), pad.l - 6, y + 3);
            }

            // X labels
            ctx.fillStyle = '#444';
            ctx.font = '10px Inter';
            ctx.textAlign = 'center';
            const step = cw / (labels.length - 1);
            labels.forEach((l, i) => {
                ctx.fillText(l, pad.l + i * step, h - 6);
            });

            // Area fill
            ctx.beginPath();
            data.forEach((v, i) => {
                const x = pad.l + i * step;
                const y = pad.t + ch - (v / max) * ch;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.lineTo(pad.l + (data.length - 1) * step, pad.t + ch);
            ctx.lineTo(pad.l, pad.t + ch);
            ctx.closePath();
            const grad = ctx.createLinearGradient(0, pad.t, 0, pad.t + ch);
            grad.addColorStop(0, 'rgba(59,130,246,0.18)');
            grad.addColorStop(1, 'rgba(59,130,246,0)');
            ctx.fillStyle = grad;
            ctx.fill();

            // Line
            ctx.beginPath();
            data.forEach((v, i) => {
                const x = pad.l + i * step;
                const y = pad.t + ch - (v / max) * ch;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.stroke();

            // Dots
            data.forEach((v, i) => {
                const x = pad.l + i * step;
                const y = pad.t + ch - (v / max) * ch;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fillStyle = '#3b82f6';
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1.5;
                ctx.stroke();
            });
        }

        function drawDoughnut() {
            const c = document.getElementById('analyticsDoughnut');
            if (!c) return;
            const ctx = c.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            c.width = 200 * dpr;
            c.height = 200 * dpr;
            ctx.scale(dpr, dpr);
            const cx = 100, cy = 100, r = 75, thickness = 22;

            const categories = [
                { name: 'Electronics', value: 42, color: '#3b82f6' },
                { name: 'Clothing', value: 31, color: '#8b5cf6' },
                { name: 'Books', value: 22, color: '#f59e0b' },
                { name: 'Water Bottles', value: 19, color: '#22c55e' },
                { name: 'Keys', value: 17, color: '#ef4444' },
                { name: 'ID Cards', value: 14, color: '#06b6d4' },
                { name: 'Other', value: 11, color: '#64748b' }
            ];
            const total = categories.reduce((s, c) => s + c.value, 0);
            let angle = -Math.PI / 2;

            categories.forEach(cat => {
                const sweep = (cat.value / total) * Math.PI * 2;
                ctx.beginPath();
                ctx.arc(cx, cy, r, angle, angle + sweep);
                ctx.arc(cx, cy, r - thickness, angle + sweep, angle, true);
                ctx.closePath();
                ctx.fillStyle = cat.color;
                ctx.fill();
                angle += sweep;
                // Gap
                angle += 0.03;
            });

            // Legend
            const legend = document.getElementById('doughnutLegend');
            if (legend) {
                legend.innerHTML = categories.map(c =>
                    `<span class="legend-item"><span class="legend-swatch" style="background:${c.color}"></span>${c.name} (${c.value})</span>`
                ).join('');
            }
        }

        function renderLocations() {
            const el = document.getElementById('analyticsLocations');
            if (!el) return;
            const locs = [
                { name: 'Cafeteria', count: 28 },
                { name: 'Gymnasium', count: 22 },
                { name: 'Media Center', count: 17 },
                { name: 'Front Lobby', count: 12 },
                { name: 'Hallway A', count: 9 },
                { name: 'Parking Lot', count: 7 },
                { name: 'Field House', count: 5 }
            ];
            const max = locs[0].count;
            el.innerHTML = locs.map((l, i) =>
                `<div class="loc-row">
                    <span class="loc-row-rank">${i + 1}</span>
                    <span class="loc-row-name">${l.name}</span>
                    <div class="loc-row-bar-bg"><div class="loc-row-bar" style="width:${(l.count / max * 100).toFixed(0)}%"></div></div>
                    <span class="loc-row-val">${l.count}</span>
                </div>`
            ).join('');
        }

        function drawHeatmap() {
            const c = document.getElementById('analyticsHeatmap');
            if (!c) return;
            const ctx = c.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = c.getBoundingClientRect();
            c.width = rect.width * dpr;
            c.height = 180 * dpr;
            ctx.scale(dpr, dpr);
            const w = rect.width, h = 180;
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            const hours = ['7a', '8a', '9a', '10a', '11a', '12p', '1p', '2p', '3p'];
            const padL = 32, padT = 16;
            const cellW = (w - padL - 10) / hours.length;
            const cellH = (h - padT - 10) / days.length;
            const data = [
                [2, 5, 3, 1, 0, 4, 2, 1, 1],
                [1, 4, 2, 2, 1, 5, 3, 2, 1],
                [3, 6, 4, 2, 1, 8, 6, 3, 2],
                [2, 5, 3, 1, 1, 7, 5, 2, 1],
                [1, 3, 2, 1, 0, 3, 2, 1, 0]
            ];
            const max = Math.max(...data.flat());

            // Hour headers
            ctx.fillStyle = '#444';
            ctx.font = '9px Inter';
            ctx.textAlign = 'center';
            hours.forEach((hr, j) => {
                ctx.fillText(hr, padL + j * cellW + cellW / 2, 10);
            });

            // Day labels + cells
            days.forEach((day, i) => {
                ctx.fillStyle = '#444';
                ctx.font = '9px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(day, padL - 4, padT + i * cellH + cellH / 2 + 3);

                hours.forEach((_, j) => {
                    const val = data[i][j];
                    const intensity = val / max;
                    ctx.fillStyle = `rgba(59,130,246,${intensity * 0.85 + 0.05})`;
                    ctx.beginPath();
                    ctx.roundRect(padL + j * cellW + 1, padT + i * cellH + 1, cellW - 2, cellH - 2, 3);
                    ctx.fill();
                });
            });
        }

        function initDashboard() {
            // Set date
            const dateEl = document.getElementById('dashDate');
            if (dateEl) {
                const now = new Date();
                dateEl.textContent = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            }

            // Sparklines
            drawSparkline('sparkPending', [3, 5, 4, 7, 6, 8, 5, 3, 4, 6], '#f59e0b');
            drawSparkline('sparkClaims', [2, 4, 3, 5, 4, 6, 3, 5, 4, 3], '#818cf8');
            drawSparkline('sparkBounties', [1, 3, 2, 4, 5, 3, 4, 6, 5, 4], '#ec4899');

            // Dashboard trend chart
            drawDashTrend();

            // Recent activity
            const recentList = document.getElementById('dashRecentList');
            if (recentList) {
                const items = [
                    { text: 'AirPods Pro submitted by student', color: '#f59e0b', time: '2m ago' },
                    { text: 'Water bottle claim approved', color: '#4ade80', time: '15m ago' },
                    { text: 'New bounty posted: Blue backpack', color: '#ec4899', time: '1h ago' },
                    { text: 'Weekly digest sent to all students', color: '#60a5fa', time: '3h ago' },
                    { text: 'iPhone charger marked as recovered', color: '#4ade80', time: '5h ago' }
                ];
                recentList.innerHTML = items.map(i =>
                    `<div class="dash-recent-item">
                        <span class="dash-recent-dot" style="background:${i.color}"></span>
                        <span class="dash-recent-text">${i.text}</span>
                        <span class="dash-recent-time">${i.time}</span>
                    </div>`
                ).join('');
            }

            // Analytics charts (drawn when panel becomes visible, but init data now)
            drawAnalyticsLine();
            drawDoughnut();
            renderLocations();
            drawHeatmap();
        }

        // Redraw charts on panel switch (canvas needs visible dimensions)
        const origSwitchPanel = window.switchPanel || switchPanel;
        const _switchPanelOrig = switchPanel;
        function switchPanelWithCharts(name) {
            _switchPanelOrig(name);
            if (name === 'analytics') {
                setTimeout(() => {
                    drawAnalyticsLine();
                    drawDoughnut();
                    renderLocations();
                    drawHeatmap();
                }, 50);
            }
            if (name === 'dashboard') {
                setTimeout(() => {
                    drawDashTrend();
                }, 50);
            }
        }

        // ==========================================
        // INIT
        // ==========================================
        loadAdminData();
        loadMapItems();
        initDashboard();
        window.switchPanel = switchPanelWithCharts;
    </script>
    <script src="js/nav-auth.js"></script>
    <script src="js/accessibility.js"></script>
</body>

</html>