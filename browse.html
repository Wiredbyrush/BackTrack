<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <title>Browse Items - BackTrack</title>
    <script>
        // Disable pulsing/flashing animations site-wide
        window.__DISABLE_ANIMATIONS__ = true;
    </script>
    <style>
        /* Disable CSS animations (stops pulsing/flashing indicators) but keep final states visible */
        * {
            animation: none !important;
            -webkit-animation: none !important;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/base.css">
    <style>
        /* Focus styles for keyboard navigation (Accessibility) */
        *:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.8);
            outline-offset: 3px;
            border-radius: 4px;
        }

        a,
        button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Navigation */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            background-color: transparent;
            height: 70px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        nav::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.nav-scrolled nav {
            background-color: #000000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        body.nav-scrolled nav::after {
            opacity: 1;
        }

        .nav-spacer {
            height: 70px;
        }

        .nav-left {
            display: flex;
            align-items: center;
            text-decoration: none;
            height: 100%;
        }

        .nav-left img {
            height: 70px;
            width: auto;
        }

        .nav-center {
            display: flex;
            gap: 48px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .nav-link.active {
            color: #ffffff;
        }

        .nav-right {
            display: flex;
            align-items: center;
        }

        .sign-in-btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, #2e2e2e 0%, #1f1f1f 100%);
            color: #f3f4f6;
            border: 1px solid #3f3f3f;
            padding: 8px 18px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, color 0.35s ease, background 0.6s ease;
            letter-spacing: 0.4px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.08);
            text-decoration: none;
            display: inline-block;
        }

        .sign-in-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -120%;
            width: 60%;
            height: 200%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transform: skewX(-20deg);
            opacity: 0;
            transition: left 0.8s ease, opacity 0.4s ease;
        }

        .sign-in-btn:hover {
            transform: translateY(-1px);
            background: linear-gradient(180deg, #f5f5f5 0%, #d9d9d9 100%);
            color: #1a1a1a;
            box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        .sign-in-btn:hover::before {
            left: 120%;
            opacity: 1;
        }

        .sign-in-btn:active {
            transform: translateY(0);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.35);
        }

        /* User Avatar */
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-decoration: none;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: 220px;
            padding: 24px;
            border-right: 1px solid #1a1a1a;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 13px;
            font-weight: 600;
            color: #888888;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        .filter-section {
            margin-bottom: 28px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 12px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkbox-box {
            width: 18px;
            height: 18px;
            border: 2px solid #444444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: transparent;
        }

        .checkbox-item input[type="checkbox"]:checked+.checkbox-box {
            background-color: #ffffff;
            border-color: #ffffff;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .checkbox-box svg {
            display: none;
            width: 12px;
            height: 12px;
        }

        .checkbox-item input[type="checkbox"]:checked+.checkbox-box svg {
            display: block;
        }

        .checkbox-label {
            font-size: 14px;
            color: #ffffff;
        }

        .date-picker-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 10px 14px;
            color: #888888;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }

        .date-picker-btn:hover {
            border-color: #444444;
        }

        .date-picker-btn svg {
            width: 18px;
            height: 18px;
            color: #888888;
        }

        .date-range {
            margin-top: 12px;
            background: #121212;
            border: 1px solid #1f1f1f;
            border-radius: 12px;
            padding: 12px;
            display: none;
            flex-direction: column;
            gap: 8px;
        }

        .date-range.active {
            display: flex;
        }

        .date-label {
            font-size: 12px;
            color: #888888;
        }

        .date-input {
            background: #0a0a0a;
            border: 1px solid #2a2a2a;
            border-radius: 10px;
            padding: 8px 10px;
            color: #ffffff;
            font-size: 12px;
        }


        .location-dropdown {
            position: relative;
        }

        .location-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 10px 14px;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }

        .location-btn:hover {
            border-color: #444444;
        }

        .location-btn svg {
            width: 16px;
            height: 16px;
            color: #888888;
        }

        .location-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            margin-top: 4px;
            overflow: hidden;
            z-index: 10;
        }

        .location-item {
            padding: 10px 14px;
            font-size: 14px;
            color: #ffffff;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .location-item:hover {
            background-color: #2a2a2a;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 24px 32px;
        }

        /* Search Bar Container */
        .search-container {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding: 0;
        }

        .search-bar {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            height: 52px;
            background: rgba(16, 25, 43, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 26px;
            padding: 0 52px 0 16px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: all 0.25s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .search-bar:focus-within {
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15), 0 0 0 1px rgba(59, 130, 246, 0.2);
            background: rgba(16, 25, 43, 0.85);
        }

        .search-bar>.search-icon {
            position: static;
            transform: none;
            width: 20px;
            height: 20px;
            color: #8ca7ce;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .search-bar:focus-within>.search-icon {
            color: #3b82f6;
        }

        .search-bar input {
            flex: 1;
            height: 100%;
            min-width: 0;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 15px;
            font-weight: 400;
            outline: none;
            padding: 0 10px;
            margin: 0;
        }

        .search-bar input::placeholder {
            color: #64748b;
        }

        /* Voice Search Button */
        .search-bar .voice-search-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            min-width: 36px;
            margin: 0;
            padding: 0;
            line-height: 0;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: #a0bded;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .search-bar .voice-search-btn::before {
            content: '';
            position: absolute;
            right: calc(100% + 8px);
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
        }

        .search-bar .voice-search-btn svg {
            position: static;
            left: auto;
            top: auto;
            width: 18px;
            height: 18px;
            display: block;
            transform: translateY(-0.5px);
            stroke: currentColor;
            pointer-events: none;
        }

        .search-bar .voice-search-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .search-bar .voice-search-btn.listening {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.15);
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {

            0%,
            100% {
                opacity: 1;
                transform: translateY(-50%) scale(1);
            }

            50% {
                opacity: 0.7;
                transform: translateY(-50%) scale(1.05);
            }
        }

        .search-bar .voice-search-btn:disabled {
            opacity: 0.45;
            cursor: not-allowed;
            animation: none;
        }

        /* AI Scan Match Button */
        .upload-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 54px;
            min-width: 270px;
            padding: 0 20px 0 16px;
            background: linear-gradient(180deg, rgba(44, 76, 137, 0.96), rgba(27, 56, 113, 0.98));
            border: 1px solid rgba(118, 162, 231, 0.56);
            border-radius: 999px;
            color: #e7f1ff;
            text-decoration: none;
            transition: border-color 0.22s ease, background-color 0.22s ease, color 0.22s ease;
            box-shadow:
                inset 0 1px 0 rgba(214, 229, 255, 0.24),
                0 10px 24px rgba(4, 14, 36, 0.48);
        }

        .content a.upload-btn,
        .content a.upload-btn:hover,
        .content a.upload-btn:visited,
        .content a.upload-btn:active {
            text-decoration: none !important;
        }

        .upload-btn:hover {
            border-color: rgba(151, 187, 246, 0.85);
            background: linear-gradient(180deg, rgba(50, 85, 150, 0.98), rgba(31, 63, 124, 1));
            color: #ffffff;
        }

        .upload-btn:focus-visible {
            outline: none;
            box-shadow:
                inset 0 1px 0 rgba(214, 229, 255, 0.24),
                0 0 0 3px rgba(59, 130, 246, 0.26);
        }

        .upload-btn-icon {
            width: 20px;
            height: 20px;
            border-radius: 0;
            background: transparent;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #cce0ff;
            line-height: 0;
        }

        .upload-btn-icon svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            display: block;
        }

        .upload-btn-text {
            display: flex;
            justify-content: center;
            line-height: 1;
        }

        .upload-btn-text strong {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.01em;
            color: #e8f2ff;
            background: none;
            -webkit-text-fill-color: currentColor;
            text-shadow: none;
        }

        .upload-btn:hover .upload-btn-text strong {
            color: #fff;
            -webkit-text-fill-color: #fff;
            text-shadow: none;
        }

        .file-input {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        .upload-status {
            margin-top: 12px;
            color: #a0a0a0;
            font-size: 13px;
        }

        .upload-status.error {
            color: #fca5a5;
        }

        .search-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            margin-bottom: 18px;
        }

        .results-count {
            font-size: 13px;
            color: #c2c2c2;
            letter-spacing: 0.2px;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: #e6e6e6;
            font-size: 12px;
        }

        .filter-chip span {
            color: #f5c518;
            font-weight: 700;
        }

        .clear-filters-btn {
            margin-left: auto;
            background: transparent;
            color: #f5c518;
            border: 1px solid rgba(245, 197, 24, 0.4);
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-filters-btn:hover {
            background: rgba(245, 197, 24, 0.12);
            border-color: rgba(245, 197, 24, 0.75);
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .view-toggle span {
            color: #666666;
        }

        .view-toggle a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
        }

        .view-toggle a.active {
            font-weight: 700;
        }

        .view-toggle .separator {
            color: #666666;
            margin: 0 4px;
        }

        /* Status Toggle */
        .status-toggle {
            display: inline-flex;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 999px;
            padding: 4px;
        }

        .status-btn {
            background: transparent;
            color: #888888;
            border: none;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-btn.active {
            background: #ffffff;
            color: #000000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Items Grid */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .item-card {
            background-color: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .item-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.6);
        }

        .item-image {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            background-color: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .save-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.6);
            color: #ffffff;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
        }

        .item-card[data-saved="true"] .save-btn {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ai-match-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: #f5c518;
            color: #000000;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            letter-spacing: 0.5px;
        }

        .skeleton-card {
            background-color: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .skeleton-image {
            width: 100%;
            aspect-ratio: 1;
            background: linear-gradient(110deg, #1a1a1a 20%, #2a2a2a 50%, #1a1a1a 80%);
            background-size: 200% 100%;
            animation: shimmer 1.4s ease infinite;
        }

        .skeleton-body {
            padding: 14px;
            display: grid;
            gap: 8px;
        }

        .skeleton-line {
            height: 10px;
            background: linear-gradient(110deg, #232323 20%, #2f2f2f 50%, #232323 80%);
            background-size: 200% 100%;
            animation: shimmer 1.4s ease infinite;
            border-radius: 999px;
        }

        .skeleton-line.short {
            width: 50%;
        }

        @keyframes shimmer {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        .item-info {
            padding: 14px;
        }

        .item-name {
            font-size: 15px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .item-date {
            font-size: 13px;
            color: #888888;
            margin-bottom: 2px;
        }

        .item-location {
            font-size: 13px;
            color: #666666;
        }

        .claim-card-btn {
            display: block;
            width: 100%;
            margin-top: 12px;
            padding: 10px 0;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }

        .claim-card-btn:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
        }

        .image-debug {
            margin-top: 8px;
            font-size: 11px;
            color: #888888;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .image-debug button {
            background: transparent;
            border: 1px solid #2a2a2a;
            color: #bdbdbd;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 999px;
            cursor: pointer;
        }

        .image-debug span {
            word-break: break-all;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .items-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 0 20px;
            }

            .nav-center {
                display: none;
            }

            .content {
                padding: 20px;
            }

            .items-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .search-container {
                flex-direction: column;
                padding: 8px;
            }

            .search-bar {
                min-height: 54px;
                padding-left: 14px;
            }

            .search-bar input {
                height: 52px;
                font-size: 14px;
            }

            .upload-btn {
                width: 100%;
                justify-content: center;
                min-width: 0;
            }

            .clear-filters-btn {
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .content {
                padding: 16px 12px;
            }

            .items-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .search-container {
                padding: 0;
            }

            .search-bar {
                min-height: 48px;
                border-radius: 20px;
            }

            .search-bar input {
                font-size: 13px;
            }

            .upload-btn {
                height: 48px;
                font-size: 13px;
            }
        }
    </style>
    <link rel="stylesheet" href="css/nav-auth.css">
    <link rel="stylesheet" href="css/theme.css">
</head>

<body>
    <a href="#main-content" class="skip-to-content">Skip to main content</a>

    <!-- Page Transition Overlay -->
    <div class="page-transition" id="pageTransition"></div>

    <!-- Navigation -->
    <nav aria-label="Main navigation" role="navigation">
        <a href="index.html" class="nav-left" aria-label="BackTrack Home">
            <span class="brand-logo">
                <img class="logo-dark" src="logo.png" alt="BackTrack - Lost and Found System">
                <img class="logo-light" src="logo-white.png" alt="" aria-hidden="true">
            </span>
        </a>

        <div class="nav-center" role="menubar">
            <a href="browse.html" class="nav-link active" role="menuitem" aria-current="page">Browse</a>
            <a href="map.html" class="nav-link" role="menuitem">Map</a>
            <a href="submit.html" class="nav-link" role="menuitem">Submit</a>
            <a href="features.html" class="nav-link" role="menuitem">Features</a>
            <a href="sources.html" class="nav-link" role="menuitem">Sources</a>
        </div>

        <div class="nav-right">
            <a class="sign-in-btn" href="login.html" aria-label="Log in to your account">Log In</a>
        </div>
    </nav>
    <div class="nav-spacer"></div>

    <div class="main-container" role="main" id="main-content">
        <!-- Sidebar -->
        <aside class="sidebar" aria-label="Filter options">
            <h2 class="sidebar-title">FILTERS</h2>

            <div class="filter-section">
                <h3 class="filter-label">Category</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" checked>
                        <span class="checkbox-box"><svg aria-hidden="true" viewBox="0 0 24 24" fill="none"
                                stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </span>
                        <span class="checkbox-label">Electronics</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox">
                        <span class="checkbox-box"><svg aria-hidden="true" viewBox="0 0 24 24" fill="none"
                                stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </span>
                        <span class="checkbox-label">Clothing</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox">
                        <span class="checkbox-box"><svg aria-hidden="true" viewBox="0 0 24 24" fill="none"
                                stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </span>
                        <span class="checkbox-label">Bottles</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox">
                        <span class="checkbox-box"><svg aria-hidden="true" viewBox="0 0 24 24" fill="none"
                                stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </span>
                        <span class="checkbox-label">Books</span>
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-label">Date Lost</h3>
                <button class="date-picker-btn" type="button" id="datePickerBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Select Date Range
                </button>
                <div class="date-range" id="dateRangePanel">
                    <label class="date-label">Start date</label>
                    <input type="date" class="date-input" id="startDate">
                    <label class="date-label">End date</label>
                    <input type="date" class="date-input" id="endDate">
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-label">Location</h3>
                <div class="location-dropdown">
                    <button class="location-btn" aria-haspopup="listbox" aria-expanded="false">
                        All Locations
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="location-menu" role="listbox" aria-label="Location filter">
                        <div class="location-item" role="option">All Locations</div>
                        <div class="location-item" role="option">Front Office / Admin</div>
                        <div class="location-item" role="option">Cafeteria</div>
                        <div class="location-item" role="option">Media Center</div>
                        <div class="location-item" role="option">Gymnasium</div>
                        <div class="location-item" role="option">Classrooms</div>
                        <div class="location-item" role="option">Computer / Science Labs</div>
                        <div class="location-item" role="option">Art / Music Rooms</div>
                        <div class="location-item" role="option">Restrooms</div>
                        <div class="location-item" role="option">Athletic Fields / Track</div>
                        <div class="location-item" role="option">Parking Lots / Bus Lot</div>
                        <div class="location-item" role="option">The Barn</div>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-label">Saved</h3>
                <label class="checkbox-item">
                    <input type="checkbox" id="savedToggle">
                    <span class="checkbox-box"><svg aria-hidden="true" aria-hidden="true" viewBox="0 0 24 24"
                            fill="none" stroke="#000000" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </span>
                    <span class="checkbox-label">Saved items only</span>
                </label>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <div class="search-container" data-voice-search="false">
                <div class="search-bar">
                    <svg class="search-icon" aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="browseSearchInput" placeholder="Search item name, place, or type..."
                        aria-label="Search found items">
                    <button type="button" class="voice-search-btn" id="voiceSearchBtn" aria-label="Search by voice"
                        title="Voice Search">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 2.5a3 3 0 0 0-3 3V12a3 3 0 0 0 6 0V5.5a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10.5V12a7 7 0 0 1-14 0v-1.5"></path>
                            <line x1="12" y1="19" x2="12" y2="22"></line>
                            <line x1="8.5" y1="22" x2="15.5" y2="22"></line>
                        </svg>
                    </button>
                </div>
                <a href="scan.html" class="upload-btn" aria-label="Use AI Scan Match">
                    <span class="upload-btn-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4.5 9V7.8A3.3 3.3 0 0 1 7.8 4.5H9"></path>
                            <path d="M19.5 9V7.8A3.3 3.3 0 0 0 16.2 4.5H15"></path>
                            <path d="M4.5 15v1.2a3.3 3.3 0 0 0 3.3 3.3H9"></path>
                            <path d="M19.5 15v1.2a3.3 3.3 0 0 1-3.3 3.3H15"></path>
                            <path d="M12 8.9v6.2M8.9 12h6.2"></path>
                            <circle cx="12" cy="12" r="2"></circle>
                        </svg>
                    </span>
                    <span class="upload-btn-text">
                        <strong>AI Scan Match</strong>
                    </span>
                </a>
            </div>
            <div class="upload-status" id="uploadStatus"></div>
            <div class="search-meta">
                <div class="results-count" id="resultsCount">Showing all items</div>
                <div class="active-filters" id="activeFilters"></div>
                <button class="clear-filters-btn" type="button" id="clearFiltersBtn">Clear filters</button>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <div class="status-toggle">
                    <button class="status-btn active" data-status="found">Found Items</button>
                    <button class="status-btn" data-status="lost">Lost Bounties</button>
                </div>
                <div class="view-toggle" style="margin-bottom: 0;">
                    <span>[</span>
                    <a href="#" class="active">Grid</a>
                    <span class="separator">|</span>
                    <a href="map.html">Map</a>
                    <span>]</span>
                </div>
            </div>

            <div class="items-grid">
                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1602143407151-7111542de6e8?w=400"
                            alt="Water bottle">
                        <span class="ai-match-badge">98% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Water bottle</h3>
                        <p class="item-date">Jun 25, 2023</p>
                        <p class="item-location">Cafeteria</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=400" alt="Hoodie">
                        <span class="ai-match-badge">98% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Hoodie</h3>
                        <p class="item-date">Jun 25, 2023</p>
                        <p class="item-location">Classrooms</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1600294037681-c80b4cb5b434?w=400" alt="AirPods">
                        <span class="ai-match-badge">85% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">AirPods</h3>
                        <p class="item-date">Jun 25, 2023</p>
                        <p class="item-location">Media Center</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1582139329536-e7284fece509?w=400" alt="Keys">
                        <span class="ai-match-badge">82% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Keys</h3>
                        <p class="item-date">Jun 25, 2023</p>
                        <p class="item-location">Gymnasium</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?w=400"
                            alt="Sweet hoodie">
                        <span class="ai-match-badge">85% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Sweet hoodie</h3>
                        <p class="item-date">Jun 23, 2023</p>
                        <p class="item-location">Parking Lots / Bus Lot</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1606220588913-b3aacb4d2f46?w=400" alt="Hooks">
                        <span class="ai-match-badge">85% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Hooks</h3>
                        <p class="item-date">Jun 23, 2023</p>
                        <p class="item-location">Athletic Fields / Track</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1611078489935-0cb964de46d6?w=400"
                            alt="Catender non">
                        <span class="ai-match-badge">85% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Catender non</h3>
                        <p class="item-date">Jun 23, 2023</p>
                        <p class="item-location">Front Office / Admin</p>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-image">
                        <img src="https://images.unsplash.com/photo-1586864387967-d02ef85d93e8?w=400"
                            alt="Myromaing invector">
                        <span class="ai-match-badge">85% AI MATCH</span>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">Myromaing invector</h3>
                        <p class="item-date">Jun 23, 2023</p>
                        <p class="item-location">Computer / Science Labs</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="admin-delete-modal" id="adminDeleteModal" aria-hidden="true">
        <div class="admin-delete-modal-content" role="dialog" aria-modal="true" aria-labelledby="adminDeleteTitle"
            aria-describedby="adminDeleteDesc">
            <div class="admin-delete-modal-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                    <path d="M10 11v6M14 11v6"></path>
                </svg>
            </div>
            <h3 id="adminDeleteTitle">Delete submission?</h3>
            <p id="adminDeleteDesc">This permanently removes the item and cannot be undone.</p>
            <div class="admin-delete-modal-actions">
                <button type="button" class="admin-delete-btn-cancel" id="adminCancelDeleteBtn">Cancel</button>
                <button type="button" class="admin-delete-btn-confirm" id="adminConfirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Chatbot Widget -->
    <style>
        /* Chatbot widget */
        .chatbot-widget {
            position: fixed;
            right: 24px;
            bottom: 24px;
            z-index: 200;
            font-family: inherit;
        }

        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(145deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 1s backwards;
            position: relative;
            overflow: hidden;
        }

        .chatbot-toggle::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 60%);
            pointer-events: none;
        }

        .chatbot-toggle::after {
            content: '';
            position: absolute;
            top: 6px;
            right: 6px;
            width: 10px;
            height: 10px;
            background: linear-gradient(135deg, #f5c518 0%, #e0a800 100%);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(245, 197, 24, 0.5);
            animation: pulse 2s ease-in-out infinite;
            display: none;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chatbot-toggle:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .chatbot-toggle:active {
            transform: scale(0.95);
        }

        .chatbot-toggle svg {
            width: 28px;
            height: 28px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .chatbot-panel {
            position: absolute;
            right: 0;
            bottom: 70px;
            width: 320px;
            max-height: 440px;
            display: none;
            flex-direction: column;
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .chatbot-panel.open {
            display: flex;
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .chatbot-header {
            padding: 14px 16px;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-title {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.4px;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: #8a8a8a;
            cursor: pointer;
            font-size: 18px;
        }

        .chatbot-messages {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            max-height: 280px;
        }

        .chatbot-message {
            font-size: 13px;
            line-height: 1.4;
            padding: 10px 12px;
            border-radius: 12px;
            background: #141414;
            color: #e5e5e5;
        }

        .chatbot-message.user {
            align-self: flex-end;
            background: #202020;
            color: #ffffff;
        }

        .chatbot-footer {
            border-top: 1px solid #1a1a1a;
            padding: 12px;
            display: flex;
            gap: 8px;
        }

        .chatbot-input {
            flex: 1;
            background: #0f0f0f;
            border: 1px solid #262626;
            border-radius: 10px;
            color: #ffffff;
            padding: 10px 12px;
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chatbot-input:focus {
            outline: none;
            border-color: #404040;
            background: #161616;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.05);
        }

        .chatbot-send {
            background: #ffffff;
            color: #111111;
            border: none;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .chatbot-send:hover {
            background: #e8e8e8;
            transform: scale(1.05);
        }

        .chatbot-send:active {
            transform: scale(0.95);
        }

        .chatbot-hint {
            color: #7a7a7a;
            font-size: 12px;
            padding: 0 16px 14px;
        }

        .chatbot-status {
            min-height: 16px;
            padding: 0 16px 10px;
            font-size: 12px;
            color: #6f6f6f;
        }

        .chatbot-status.error {
            color: #fca5a5;
        }

        @media (max-width: 768px) {
            .chatbot-widget {
                right: 16px;
                bottom: 16px;
            }

            .chatbot-panel {
                width: 280px;
            }
        }

        .admin-delete-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            width: 38px;
            height: 38px;
            display: none;
            /* hidden by default, shown when body has .admin-mode */
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        body.admin-mode .admin-delete-btn {
            display: flex;
        }

        /* Admin Delete Modal */
        .admin-delete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .admin-delete-modal.active {
            display: flex;
        }

        .admin-delete-modal-content {
            background: #1a1a1c;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.light-theme .admin-delete-modal-content {
            background: #ffffff;
            border-color: rgba(0, 0, 0, 0.1);
        }

        .admin-delete-modal-icon {
            width: 48px;
            height: 48px;
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .admin-delete-modal h3 {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        body.light-theme .admin-delete-modal h3 {
            color: #111827;
        }

        .admin-delete-modal p {
            color: #9ca3af;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 24px;
        }

        body.light-theme .admin-delete-modal p {
            color: #4b5563;
        }

        .admin-delete-modal-actions {
            display: flex;
            gap: 12px;
        }

        .admin-delete-btn-cancel {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        body.light-theme .admin-delete-btn-cancel {
            background: #f3f4f6;
            border-color: #d1d5db;
            color: #374151;
        }

        .admin-delete-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-theme .admin-delete-btn-cancel:hover {
            background: #e5e7eb;
        }

        .admin-delete-btn-confirm {
            flex: 1;
            padding: 10px;
            background: #ef4444;
            border: 1px solid #ef4444;
            color: #ffffff;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-delete-btn-confirm:hover {
            background: #dc2626;
            border-color: #dc2626;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .admin-delete-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #f87171;
        }

        body.light-theme .admin-delete-btn {
            background: rgba(239, 68, 68, 0.05);
            border-color: rgba(239, 68, 68, 0.15);
        }

        body.light-theme .admin-delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
    </style>

    <div class="chatbot-widget">
        <button class="chatbot-toggle" id="chatbotToggle" aria-label="Open chat assistant">
            <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" aria-hidden="true">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                <circle cx="9" cy="10" r="1" fill="#ffffff" />
                <circle cx="12" cy="10" r="1" fill="#ffffff" />
                <circle cx="15" cy="10" r="1" fill="#ffffff" />
            </svg>
        </button>
        <div class="chatbot-panel" id="chatbotPanel">
            <div class="chatbot-header">
                <div class="chatbot-title">BackTrack Assistant</div>
                <button class="chatbot-close" id="chatbotClose">&times;</button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chatbot-message">Ask me about BackTrack's features, how to submit items, or how browsing
                    works.</div>
            </div>
            <div class="chatbot-hint">Questions outside the website won't be answered.</div>
            <div class="chatbot-status" id="chatbotStatus"></div>
            <div class="chatbot-footer">
                <input class="chatbot-input" id="chatbotInput" type="text" placeholder="Ask about BackTrack..." />
                <button class="chatbot-send" id="chatbotSend">Send</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="padding: 60px 80px 40px; border-top: 1px solid rgba(255,255,255,0.06);">
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 48px; margin-bottom: 48px;">
            <div>
                <div style="font-size: 18px; font-weight: 700; margin-bottom: 12px;">BackTrack</div>
                <p style="color: #888888; font-size: 14px; line-height: 1.6; max-width: 280px;">A centralized
                    lost-and-found system for students and staff. Built for FBLA Coding & Programming.</p>
            </div>
            <div>
                <div
                    style="font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #888888; margin-bottom: 16px;">
                    Product</div>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="browse.html" style="color: #777777; text-decoration: none; font-size: 14px;">Browse
                        Items</a>
                    <a href="submit.html" style="color: #777777; text-decoration: none; font-size: 14px;">Submit
                        Item</a>
                    <a href="claim.html" style="color: #777777; text-decoration: none; font-size: 14px;">Claim Item</a>
                    <a href="map.html" style="color: #777777; text-decoration: none; font-size: 14px;">Campus Map</a>
                </div>
            </div>
            <div>
                <div
                    style="font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #888888; margin-bottom: 16px;">
                    Resources</div>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="features.html" style="color: #777777; text-decoration: none; font-size: 14px;">Features</a>
                    <a href="sources.html" style="color: #777777; text-decoration: none; font-size: 14px;">Sources</a>
                </div>
            </div>
            <div>
                <div
                    style="font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #888888; margin-bottom: 16px;">
                    Account</div>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="login.html" style="color: #777777; text-decoration: none; font-size: 14px;">Log In</a>
                    <a href="signup.html" style="color: #777777; text-decoration: none; font-size: 14px;">Sign Up</a>
                    <a href="profile.html" style="color: #777777; text-decoration: none; font-size: 14px;">Profile</a>
                </div>
            </div>
        </div>
        <div
            style="display: flex; justify-content: space-between; align-items: center; padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.06); flex-wrap: wrap; gap: 12px;">
            <div style="color: #888888; font-size: 13px;">&copy; 20252026 BackTrack. Built for FBLA Coding &amp;
                Programming.</div>
            <div style="color: #888888; font-size: 13px;">Made by BackTrack Team</div>
        </div>
    </footer>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script>
        // DOM Elements
        const itemsGrid = document.querySelector('.items-grid');
        const initialItemsMarkup = itemsGrid.innerHTML;

        itemsGrid.addEventListener('click', (event) => {
            const target = event.target;
            if (target.closest('.debug-toggle')) return;
            const saveBtn = target.closest('.save-btn');
            if (saveBtn) {
                event.stopPropagation();
                const card = saveBtn.closest('.item-card');
                const id = card ? card.dataset.id : null;
                if (id) {
                    const saved = toggleSavedItem(id);
                    card.dataset.saved = saved;
                    saveBtn.textContent = saved ? 'Saved' : 'Save';
                    saveBtn.setAttribute('aria-pressed', saved ? 'true' : 'false');
                }
                return;
            }
            const card = target.closest('.item-card');
            if (!card) return;
            const id = card.dataset.id;
            if (id) {
                window.location.href = `claim.html?item=${id}`;
            }
        });
        const searchInput = document.getElementById('browseSearchInput');
        const voiceSearchBtn = document.getElementById('voiceSearchBtn');
        const statusBtns = document.querySelectorAll('.status-btn');
        const datePickerBtn = document.getElementById('datePickerBtn');
        const dateRangePanel = document.getElementById('dateRangePanel');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const resultsCount = document.getElementById('resultsCount');
        const activeFilters = document.getElementById('activeFilters');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const categoryCheckboxes = document.querySelectorAll('.checkbox-item input[type="checkbox"]');
        const savedToggle = document.getElementById('savedToggle');
        const locationBtn = document.querySelector('.location-btn');
        const locationMenu = document.querySelector('.location-menu');
        const locationItems = document.querySelectorAll('.location-item');
        const pageBody = document.body;
        const adminDeleteModal = document.getElementById('adminDeleteModal');
        const adminConfirmDeleteBtn = document.getElementById('adminConfirmDeleteBtn');
        const adminCancelDeleteBtn = document.getElementById('adminCancelDeleteBtn');
        let lastImageQuery = '';
        let lastImageKeywords = [];
        let currentUserIsAdmin = false;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let voiceRecognition = null;
        let isVoiceListening = false;

        function updateNavBorder() {
            pageBody.classList.toggle('nav-scrolled', window.scrollY > 4);
        }

        function setVoiceButtonState(listening) {
            if (!voiceSearchBtn) return;
            isVoiceListening = listening;
            voiceSearchBtn.classList.toggle('listening', listening);
            voiceSearchBtn.setAttribute('aria-pressed', listening ? 'true' : 'false');
            voiceSearchBtn.title = listening ? 'Stop Voice Search' : 'Voice Search';
        }

        function initVoiceSearch() {
            if (!voiceSearchBtn || !searchInput) return;

            if (!SpeechRecognition) {
                voiceSearchBtn.disabled = true;
                voiceSearchBtn.title = 'Voice search is not supported in this browser';
                return;
            }

            voiceRecognition = new SpeechRecognition();
            voiceRecognition.continuous = false;
            voiceRecognition.interimResults = true;
            voiceRecognition.lang = 'en-US';
            voiceRecognition.maxAlternatives = 1;

            voiceSearchBtn.addEventListener('click', () => {
                if (!voiceRecognition) return;
                if (isVoiceListening) {
                    voiceRecognition.stop();
                    return;
                }

                try {
                    voiceRecognition.start();
                } catch (error) {
                    setUploadStatus('Voice search is unavailable right now. Try again.', true);
                    setVoiceButtonState(false);
                }
            });

            voiceRecognition.onstart = () => {
                setVoiceButtonState(true);
                setUploadStatus('Listening... speak now.');
            };

            voiceRecognition.onresult = (event) => {
                const result = event.results[event.resultIndex];
                if (!result || !result[0]) return;
                const transcript = String(result[0].transcript || '').trim();
                if (!transcript) return;

                searchInput.value = transcript;
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            };

            voiceRecognition.onerror = (event) => {
                if (event.error === 'no-speech') {
                    setUploadStatus('No speech detected. Tap the mic and try again.', true);
                } else if (event.error !== 'aborted') {
                    setUploadStatus('Voice search error. Please try again.', true);
                }
                setVoiceButtonState(false);
            };

            voiceRecognition.onend = () => {
                if (!isVoiceListening) return;
                setVoiceButtonState(false);
                if (searchInput.value.trim()) {
                    setUploadStatus('');
                }
            };
        }

        let itemToDeleteId = null;

        function deleteItemCard(id) {
            if (!currentUserIsAdmin) return;
            itemToDeleteId = id;
            if (adminDeleteModal) {
                adminDeleteModal.classList.add('active');
                adminDeleteModal.setAttribute('aria-hidden', 'false');
            }
        }

        function closeAdminDeleteModal() {
            itemToDeleteId = null;
            if (adminDeleteModal) {
                adminDeleteModal.classList.remove('active');
                adminDeleteModal.setAttribute('aria-hidden', 'true');
            }
        }

        adminConfirmDeleteBtn?.addEventListener('click', async () => {
            if (!itemToDeleteId || !currentUserIsAdmin || typeof window.BackTrackDB?.deleteItem !== 'function') return;
            const btn = adminConfirmDeleteBtn;
            const originalText = btn.textContent;
            btn.textContent = 'Deleting...';
            btn.disabled = true;

            try {
                const ok = await window.BackTrackDB.deleteItem(itemToDeleteId);
                if (!ok) throw new Error('Delete not permitted');

                closeAdminDeleteModal();
                await loadItems();
            } catch (err) {
                console.error('Error deleting item:', err);
                alert('Failed to delete item. You may not have permission.');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        });

        adminCancelDeleteBtn?.addEventListener('click', closeAdminDeleteModal);
        adminDeleteModal?.addEventListener('click', (event) => {
            if (event.target === adminDeleteModal) {
                closeAdminDeleteModal();
            }
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && adminDeleteModal?.classList.contains('active')) {
                closeAdminDeleteModal();
            }
        });

        let currentFilters = {
            category: [],
            location: 'All Locations',
            search: '',
            startDate: '',
            endDate: '',
            savedOnly: false,
            view: 'found',
            status: ['found', 'claimed']
        };

        const locationMapping = {
            'Front Office / Admin': ['Front Office', 'Guidance'],
            'Cafeteria': ['Cafeteria'],
            'Media Center': ['Media Center'],
            'Gymnasium': ['Gymnasium', 'Weight Room'],
            'Classrooms': [
                'Room 101', 'Room 102', 'Room 103', 'Room 104', 'Room 105',
                'Room 106', 'Room 107', 'Room 108', 'Room 109', 'Room 201',
                'Room 202', 'Room 203', 'Room 204', 'Room 205', 'Room 206',
                'Room 207', 'Room 208', 'Room 209', 'Room 210', 'Room 211', 'Room 212'
            ],
            'Computer / Science Labs': ['Computer Lab', 'Science Lab 1', 'Science Lab 2'],
            'Art / Music Rooms': ['Art Room', 'Music Room'],
            'Restrooms': ['Restrooms'],
            'Athletic Fields / Track': ['Track & Stadium', 'Soccer Field', 'Baseball Field', 'Softball Field', 'Tennis Courts'],
            'Parking Lots / Bus Lot': ['Student Parking', 'Visitor Parking', 'Staff Parking', 'Bus Lot'],
            'The Barn': ['The Barn']
        };

        const allCategories = Array.from(categoryCheckboxes).map((checkbox) => {
            return checkbox.parentElement.querySelector('.checkbox-label').textContent;
        });

        let activeMatchContext = null;

        const demoItems = Array.from(itemsGrid.querySelectorAll('.item-card')).map((card, index) => {
            const image = card.querySelector('img');
            const name = card.querySelector('.item-name');
            const date = card.querySelector('.item-date');
            const location = card.querySelector('.item-location');
            const badge = card.querySelector('.ai-match-badge');
            return {
                id: `demo-${index}`,
                name: name ? name.textContent.trim() : 'Item',
                date_lost: date ? date.textContent.trim() : new Date().toISOString(),
                location: location ? location.textContent.trim() : 'Location',
                image_url: image ? image.getAttribute('src') : null,
                similarity: badge ? 0.9 : null
            };
        });

        function isSupabaseConfigured() {
            return window.BackTrackDB && window.BackTrackDB.config &&
                !window.BackTrackDB.config.url.includes('YOUR_SUPABASE');
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function getSavedItems() {
            try {
                return new Set(JSON.parse(localStorage.getItem('savedItems') || '[]'));
            } catch (err) {
                return new Set();
            }
        }

        function setSavedItems(ids) {
            localStorage.setItem('savedItems', JSON.stringify(Array.from(ids)));
        }

        function isSavedItem(id) {
            return getSavedItems().has(id);
        }

        function toggleSavedItem(id) {
            const saved = getSavedItems();
            if (saved.has(id)) {
                saved.delete(id);
            } else {
                saved.add(id);
            }
            setSavedItems(saved);
            return saved.has(id);
        }

        function buildImageCandidates(imageUrl) {
            if (!imageUrl) return [];

            const trimmed = imageUrl.trim();
            if (trimmed.startsWith('data:') || trimmed.startsWith('blob:')) {
                return [trimmed.replace(/\s+/g, '')];
            }

            if (trimmed.startsWith('http')) {
                const candidates = [trimmed];
                const fixedBucket = trimmed.replace(/\/storage\/v1\/object\/public\/[^/]+\//, '/storage/v1/object/public/images/');
                if (fixedBucket !== trimmed) {
                    candidates.push(fixedBucket);
                }
                return candidates;
            }

            const cleanPath = trimmed.replace(/^\/+/, '');
            const baseUrl = window.BackTrackDB?.config?.url || 'https://mzzcwukenxzuelgpuiap.supabase.co';
            const paths = [];
            if (!cleanPath.startsWith('items/')) {
                paths.push(`items/${cleanPath}`);
            }
            paths.push(cleanPath);
            return paths.map((path) => `${baseUrl}/storage/v1/object/public/images/${encodeURI(path)}`);
        }

        function computeMatchScore(item, keywords) {
            if (!keywords || keywords.length === 0) return null;
            const haystack = [
                item.name,
                item.description,
                item.category,
                item.location
            ]
                .filter(Boolean)
                .join(' ')
                .toLowerCase();

            const uniqueKeywords = Array.from(new Set(keywords.map((keyword) => keyword.toLowerCase())));
            const hits = uniqueKeywords.filter((keyword) => haystack.includes(keyword));
            const rawScore = Math.round((hits.length / uniqueKeywords.length) * 100);
            return Math.max(rawScore, hits.length > 0 ? 35 : 0);
        }

        // Create item card HTML
        function createItemCard(item, matchPercent = null) {
            const placeholderImage = 'logo.png';
            const rawImage = item.image_url || '';
            const immediateCandidates = buildImageCandidates(rawImage);
            const initialSrc = immediateCandidates.length &&
                (rawImage.startsWith('data:') || rawImage.startsWith('blob:') || rawImage.startsWith('http'))
                ? immediateCandidates[0]
                : placeholderImage;
            const dataPath = (rawImage.startsWith('data:') || rawImage.startsWith('blob:') || rawImage.startsWith('http'))
                ? ''
                : rawImage;
            const similarityScore = typeof item.similarity === 'number'
                ? Math.min(99, Math.max(70, Math.round(item.similarity * 100)))
                : null;
            const resolvedMatch = matchPercent !== null ? matchPercent : similarityScore;
            const badge = resolvedMatch !== null
                ? `<span class="ai-match-badge">${resolvedMatch}% AI MATCH</span>`
                : '';
            const saved = isSavedItem(item.id);
            const pendingBadge = currentUserIsAdmin && String(item.status || '').toLowerCase() === 'pending'
                ? '<span style="display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:999px;border:1px solid rgba(234,179,8,0.45);background:rgba(234,179,8,0.16);color:#fde68a;font-size:11px;font-weight:700;letter-spacing:0.04em;text-transform:uppercase;">Pending</span>'
                : '';
            const isBounty = Boolean(item.is_bounty || item.isBounty) || String(item.status || '').toLowerCase() === 'bounty' || String(item.status || '').toLowerCase() === 'lost';
            const urgencyRaw = String(item.urgency || '').toLowerCase();
            const urgencyBadge = (isBounty && urgencyRaw)
                ? `<span class="urgency-badge urgency-${urgencyRaw}" style="font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); margin-left: 8px; vertical-align: middle; text-transform: capitalize;">${urgencyRaw}</span>`
                : '';
            const deleteBtn = currentUserIsAdmin
                ? `
                   <button type="button" class="admin-delete-btn" onclick="event.preventDefault(); event.stopPropagation(); deleteItemCard('${item.id}'); return false;" aria-label="Delete Item" title="Delete Item">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
                    </svg>
                   </button>`
                : '';

            return `
                <div class="item-card" data-id="${item.id}" data-saved="${saved}">
                    <div class="item-image">
                        <img class="item-image-img" src="${initialSrc}" data-image-path="${dataPath}" data-image-raw="${rawImage}" alt="${item.name}">
                        ${badge}
                        <button class="save-btn" type="button" aria-pressed="${saved}" aria-label="Save item">
                            ${saved ? 'Saved' : 'Save'}
                        </button>
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">${item.name}${urgencyBadge}</h3>
                        ${pendingBadge}
                        <p class="item-date">${formatDate(item.date_lost)}</p>
                        <p class="item-location">${item.location}</p>
                        <div style="display: flex; gap: 8px; align-items: center; margin-top: 12px;">
                            <button type="button" class="claim-card-btn" style="flex: 1;" onclick="event.stopPropagation(); window.location.href='claim.html?item=${item.id}'">Claim Item</button>
                            ${deleteBtn}
                        </div>
                    </div>
                </div>
            `;
        }

        // Render items to grid
        function hydrateItemImages() {
            const placeholder = 'logo.png';
            const images = itemsGrid.querySelectorAll('.item-image-img');
            images.forEach((img) => {
                const path = img.getAttribute('data-image-path');
                if (!path) {
                    return;
                }
                const candidates = buildImageCandidates(path);
                let index = 0;
                const tryNext = () => {
                    if (index >= candidates.length) {
                        img.src = placeholder;
                        img.onerror = null;
                        return;
                    }
                    img.src = candidates[index];
                    index += 1;
                };
                img.onerror = () => tryNext();
                tryNext();
            });

            const toggles = itemsGrid.querySelectorAll('.debug-toggle');
            toggles.forEach((toggle) => {
                toggle.addEventListener('click', () => {
                    const value = toggle.getAttribute('data-image-path') || '(empty)';
                    const container = toggle.parentElement;
                    const label = container.querySelector('.debug-value');
                    if (!label) return;
                    const isHidden = label.hasAttribute('hidden');
                    if (isHidden) {
                        label.textContent = value;
                        label.removeAttribute('hidden');
                        toggle.textContent = 'Hide image URL';
                    } else {
                        label.textContent = '';
                        label.setAttribute('hidden', '');
                        toggle.textContent = 'Show image URL';
                    }
                });
            });
        }

        function renderItems(items, showDemoFallback = false) {
            let visibleItems = items;
            if (currentFilters.savedOnly) {
                const saved = getSavedItems();
                visibleItems = items.filter(item => saved.has(item.id));
            }

            if (visibleItems.length === 0) {
                if (showDemoFallback && initialItemsMarkup.trim().length > 0) {
                    itemsGrid.innerHTML = initialItemsMarkup;
                    updateResultsCount(demoItems.length, true);
                    return;
                }

                itemsGrid.innerHTML = '<p style="color: #888; grid-column: 1/-1; text-align: center; padding: 40px;">No items found. Be the first to <a href="submit.html" style="color: #fff; text-decoration: underline;">submit an item</a>!</p>';
                updateResultsCount(0);
                return;
            }
            if (activeMatchContext && Array.isArray(activeMatchContext.keywords)) {
                const scored = visibleItems.map((item) => {
                    const score = computeMatchScore(item, activeMatchContext.keywords);
                    return { item, score: score ?? 0 };
                });
                scored.sort((a, b) => b.score - a.score);
                itemsGrid.innerHTML = scored
                    .map(({ item, score }) => createItemCard(item, score))
                    .join('');
                hydrateItemImages();
                updateResultsCount(scored.length, showDemoFallback);
                return;
            }

            itemsGrid.innerHTML = visibleItems.map((item) => createItemCard(item)).join('');
            hydrateItemImages();
            updateResultsCount(visibleItems.length, showDemoFallback);
        }

        function updateResultsCount(count, isDemo = false) {
            if (!resultsCount) return;
            const label = isDemo ? 'Showing demo items' : 'Showing items';
            resultsCount.textContent = `${label}: ${count}`;
        }

        function updateActiveFilters() {
            if (!activeFilters || !clearFiltersBtn) return;
            const chips = [];

            if (currentFilters.search && currentFilters.search.trim()) {
                chips.push(`<div class="filter-chip"><span>Query</span>${currentFilters.search.trim()}</div>`);
            }

            if (currentFilters.category.length > 0 && currentFilters.category.length < allCategories.length) {
                chips.push(`<div class="filter-chip"><span>Category</span>${currentFilters.category.join(', ')}</div>`);
            }

            if (currentFilters.location && currentFilters.location !== 'All Locations') {
                chips.push(`<div class="filter-chip"><span>Location</span>${currentFilters.location}</div>`);
            }

            if (currentFilters.startDate || currentFilters.endDate) {
                const startLabel = currentFilters.startDate || 'Any';
                const endLabel = currentFilters.endDate || 'Any';
                chips.push(`<div class="filter-chip"><span>Date</span>${startLabel}  ${endLabel}</div>`);
            }

            if (currentFilters.savedOnly) {
                chips.push('<div class="filter-chip"><span>Saved</span>Only</div>');
            }

            if (lastImageQuery) {
                chips.push(`<div class="filter-chip"><span>AI</span>${lastImageQuery}</div>`);
            } else if (lastImageKeywords.length) {
                chips.push(`<div class="filter-chip"><span>AI</span>${lastImageKeywords.join(', ')}</div>`);
            }

            activeFilters.innerHTML = chips.join('');
            clearFiltersBtn.style.display = chips.length ? 'inline-flex' : 'none';
        }

        function renderLoadingState() {
            const placeholders = Array.from({ length: 8 }, () => (
                `<div class="skeleton-card">
                    <div class="skeleton-image"></div>
                    <div class="skeleton-body">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>`
            )).join('');
            itemsGrid.innerHTML = placeholders;
        }

        function renderDemoItems() {
            if (activeMatchContext) {
                renderItems(demoItems);
                return;
            }

            const query = (currentFilters.search || '').trim().toLowerCase();
            if (!query) {
                renderItems(demoItems, true);
                return;
            }
            const filtered = demoItems.filter((item) => item.name.toLowerCase().includes(query));
            renderItems(filtered, true);
        }

        function normalizeStatus(value) {
            return String(value || '').trim().toLowerCase();
        }

        function getFetchFilters() {
            const filters = { ...currentFilters };
            if (currentUserIsAdmin && Array.isArray(filters.status)) {
                const statuses = new Set(filters.status.map((status) => normalizeStatus(status)));
                statuses.add('pending');
                filters.status = Array.from(statuses);
            }
            if (filters.location && filters.location !== 'All Locations') {
                const mappedLocs = locationMapping[filters.location] || [];
                filters.location = [filters.location, ...mappedLocs];
            }
            return filters;
        }

        function applyAdminStatusVisibility(items) {
            if (!currentUserIsAdmin) return items;

            const isLostView = currentFilters.view === 'lost';
            return (Array.isArray(items) ? items : []).filter((item) => {
                const status = normalizeStatus(item.status);
                if (status !== 'pending') return true;
                const isBounty = Boolean(item.is_bounty || item.isBounty);
                return isLostView ? isBounty : !isBounty;
            });
        }

        function syncCategoryFiltersFromUI() {
            const selectedCategories = [];
            categoryCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const label = checkbox.parentElement.querySelector('.checkbox-label').textContent;
                    selectedCategories.push(label);
                }
            });
            currentFilters.category = selectedCategories.length === allCategories.length ? [] : selectedCategories;
            updateActiveFilters();
        }

        // Fetch and display items
        async function loadItems() {
            if (!isSupabaseConfigured() || typeof window.BackTrackDB.getItems !== 'function') {
                renderDemoItems();
                return;
            }

            if (!currentUserIsAdmin) {
                currentUserIsAdmin = await window.BackTrackDB.isAdmin();
            }

            const hasExistingItems = itemsGrid.querySelectorAll('.item-card:not(.skeleton-card)').length > 0;
            if (!hasExistingItems) {
                renderLoadingState();
            }

            const items = await window.BackTrackDB.getItems(getFetchFilters());
            renderItems(applyAdminStatusVisibility(items));
        }

        // Location dropdown toggle
        let locationMenuOpen = false;
        locationBtn.addEventListener('click', () => {
            locationMenuOpen = !locationMenuOpen;
            locationMenu.style.display = locationMenuOpen ? 'block' : 'none';
            locationBtn.setAttribute('aria-expanded', locationMenuOpen);
        });

        // Location selection
        locationItems.forEach(item => {
            item.addEventListener('click', () => {
                activeMatchContext = null;
                currentFilters.location = item.textContent;
                locationBtn.childNodes[0].textContent = item.textContent + ' ';
                locationMenu.style.display = 'none';
                locationMenuOpen = false;
                locationBtn.setAttribute('aria-expanded', 'false');
                updateActiveFilters();
                loadItems();
            });
        });

        // Close location menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.location-dropdown')) {
                locationMenu.style.display = 'none';
                locationMenuOpen = false;
                locationBtn.setAttribute('aria-expanded', 'false');
            }
        });

        // Category filter
        categoryCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                activeMatchContext = null;
                const label = checkbox.parentElement.querySelector('.checkbox-label').textContent;
                if (checkbox.checked) {
                    currentFilters.category.push(label);
                } else {
                    currentFilters.category = currentFilters.category.filter(c => c !== label);
                }
                updateActiveFilters();
                loadItems();
            });
        });

        if (savedToggle) {
            savedToggle.addEventListener('change', () => {
                currentFilters.savedOnly = savedToggle.checked;
                updateActiveFilters();
                loadItems();
            });
        }

        datePickerBtn.addEventListener('click', () => {
            dateRangePanel.classList.toggle('active');
        });

        function applyDateRange() {
            activeMatchContext = null;
            currentFilters.startDate = startDateInput.value;
            currentFilters.endDate = endDateInput.value;
            updateActiveFilters();
            loadItems();
        }

        startDateInput.addEventListener('change', applyDateRange);
        endDateInput.addEventListener('change', applyDateRange);

        // Search functionality
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                activeMatchContext = null;
                currentFilters.search = searchInput.value;
                updateActiveFilters();
                if (isSupabaseConfigured()) {
                    loadItems();
                } else {
                    renderDemoItems();
                }
            }, 300);
        });

        function setUploadStatus(text, isError = false) {
            if (!text) {
                uploadStatus.textContent = '';
                uploadStatus.classList.remove('error');
                return;
            }
            uploadStatus.textContent = text;
            uploadStatus.classList.toggle('error', isError);
        }

        // Uses credentials from supabase.js
        const MATCH_SUPABASE_URL = window.BackTrackDB?.config?.url || 'YOUR_SUPABASE_PROJECT_URL';
        const MATCH_SUPABASE_ANON_KEY = window.BackTrackDB?.config?.anonKey || 'YOUR_SUPABASE_ANON_KEY';

        async function requestImageMatch(base64DataUrl) {
            const response = await fetch(`${MATCH_SUPABASE_URL}/functions/v1/image-match`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    apikey: MATCH_SUPABASE_ANON_KEY,
                    Authorization: `Bearer ${MATCH_SUPABASE_ANON_KEY}`
                },
                body: JSON.stringify({ imageBase64: base64DataUrl })
            });

            const payload = await response.json().catch(() => ({}));
            if (!response.ok) {
                const errorDetail = payload.error || `HTTP ${response.status}`;
                throw new Error(errorDetail);
            }
            return payload;
        }

        statusBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                statusBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const status = btn.getAttribute('data-status');
                if (status === 'lost') {
                    currentFilters.view = 'lost';
                    currentFilters.status = ['lost', 'bounty'];
                    searchInput.placeholder = "Search lost bounties...";
                } else {
                    currentFilters.view = 'found';
                    currentFilters.status = ['found', 'claimed'];
                    searchInput.placeholder = "Search smart (earbuds, AirPods, headphones)...";
                }
                updateActiveFilters();
                if (isSupabaseConfigured()) {
                    loadItems();
                } else {
                    renderDemoItems();
                }
            });
        });

        // Add URL parameter checking for status matching
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('status') === 'lost') {
            const lostBtn = document.querySelector('.status-btn[data-status="lost"]');
            if (lostBtn) lostBtn.click();
        }

        clearFiltersBtn.addEventListener('click', () => {
            currentFilters.search = '';
            currentFilters.location = 'All Locations';
            currentFilters.category = [];
            currentFilters.startDate = '';
            currentFilters.endDate = '';
            currentFilters.savedOnly = false;
            currentFilters.view = 'found';
            currentFilters.status = ['found', 'claimed'];
            lastImageQuery = '';
            lastImageKeywords = [];
            activeMatchContext = null;
            searchInput.value = '';
            searchInput.placeholder = "Search smart (earbuds, AirPods, headphones)...";
            locationBtn.childNodes[0].textContent = 'All Locations ';
            startDateInput.value = '';
            endDateInput.value = '';
            categoryCheckboxes.forEach((checkbox) => {
                checkbox.checked = true;
            });
            statusBtns.forEach((button) => button.classList.remove('active'));
            document.querySelector('.status-btn[data-status="found"]')?.classList.add('active');
            if (savedToggle) savedToggle.checked = false;
            syncCategoryFiltersFromUI();
            updateActiveFilters();
            loadItems();
        });

        // Initialize - check if Supabase is configured
        document.addEventListener('DOMContentLoaded', async () => {
            // Check for AI scan params
            const scanParams = new URLSearchParams(window.location.search);
            if (scanParams.get('ai_scan') === 'true') {
                try {
                    const keys = JSON.parse(sessionStorage.getItem('ai_scan_keywords') || '[]');
                    const desc = sessionStorage.getItem('ai_scan_query') || '';
                    if (keys.length > 0) {
                        activeMatchContext = { keywords: keys, description: desc };
                        lastImageKeywords = keys;
                        lastImageQuery = desc;
                        // wipe it so refresh doesn't keep triggering
                        sessionStorage.removeItem('ai_scan_keywords');
                        sessionStorage.removeItem('ai_scan_query');
                        // Make sure we show 'found' explicitly to search the whole database
                        currentFilters.view = 'found';
                        currentFilters.status = ['found', 'claimed'];
                        // remove URL param visually while maintaining state
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                } catch (e) { }
            }

            // Hide location menu by default
            locationMenu.style.display = 'none';

            updateNavBorder();
            window.addEventListener('scroll', updateNavBorder, { passive: true });

            categoryCheckboxes.forEach((checkbox) => {
                checkbox.checked = true;
            });
            initVoiceSearch();
            syncCategoryFiltersFromUI();
            activeMatchContext = null;
            updateActiveFilters();

            // Check if Supabase is configured
            if (isSupabaseConfigured()) {
                window.BackTrackDB.onAuthStateChange(async (event, session) => {
                    const wasAdmin = currentUserIsAdmin;
                    currentUserIsAdmin = await window.BackTrackDB.isAdmin();
                    document.body.classList.toggle('admin-mode', currentUserIsAdmin);
                    if (wasAdmin !== currentUserIsAdmin) {
                        await loadItems();
                    }
                });

                currentUserIsAdmin = await window.BackTrackDB.isAdmin();
                document.body.classList.toggle('admin-mode', currentUserIsAdmin);
                loadItems();

                setInterval(() => {
                    // Only auto-refresh if user is not actively typing or hovering a card
                    const isHovering = document.querySelector('.item-card:hover');
                    if (document.activeElement !== searchInput && !isHovering) {
                        loadItems();
                    }
                }, 20000);
            } else {
                console.log('Supabase not configured - showing demo items');
                renderDemoItems();
            }
        });


        // Chatbot
        const chatbotToggle = document.getElementById('chatbotToggle');
        const chatbotPanel = document.getElementById('chatbotPanel');
        const chatbotClose = document.getElementById('chatbotClose');
        const chatbotMessages = document.getElementById('chatbotMessages');
        const chatbotInput = document.getElementById('chatbotInput');
        const chatbotSend = document.getElementById('chatbotSend');
        const chatbotStatus = document.getElementById('chatbotStatus');

        function setChatStatus(text, type) {
            if (!text) { chatbotStatus.textContent = ''; chatbotStatus.className = 'chatbot-status'; return; }
            chatbotStatus.textContent = text;
            chatbotStatus.className = `chatbot-status ${type || ''}`.trim();
        }

        function addChatMessage(text, role) {
            const message = document.createElement('div');
            message.className = `chatbot-message ${role || ''}`.trim();
            message.textContent = text;
            chatbotMessages.appendChild(message);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function toggleChat(open) { chatbotPanel.classList.toggle('open', open); }

        chatbotToggle.addEventListener('click', () => toggleChat(true));
        chatbotClose.addEventListener('click', () => toggleChat(false));

        const CHAT_SUPABASE_URL = window.BackTrackDB?.config?.url || 'YOUR_SUPABASE_PROJECT_URL';
        const CHAT_SUPABASE_ANON_KEY = window.BackTrackDB?.config?.anonKey || 'YOUR_SUPABASE_ANON_KEY';

        async function fetchChatbotReply(message) {
            if (!CHAT_SUPABASE_URL || !CHAT_SUPABASE_ANON_KEY || CHAT_SUPABASE_URL.includes('YOUR_SUPABASE')) {
                throw new Error('Supabase is not configured.');
            }
            const response = await fetch(`${CHAT_SUPABASE_URL}/functions/v1/chatbot`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', apikey: CHAT_SUPABASE_ANON_KEY, Authorization: `Bearer ${CHAT_SUPABASE_ANON_KEY}` },
                body: JSON.stringify({ message })
            });
            const payload = await response.json().catch(() => ({}));
            if (!response.ok) throw new Error(payload.error || `HTTP ${response.status}`);
            return payload.reply || '';
        }

        async function sendChat() {
            const text = chatbotInput.value.trim();
            if (!text) return;
            chatbotInput.value = '';
            addChatMessage(text, 'user');
            setChatStatus('');
            addChatMessage('Thinking...');
            const thinkingMessage = chatbotMessages.lastElementChild;
            try {
                const reply = await fetchChatbotReply(text);
                thinkingMessage.textContent = reply || 'No response received.';
            } catch (error) {
                setChatStatus('Chatbot error: ' + String(error), 'error');
                thinkingMessage.textContent = 'Sorry, something went wrong. Please try again.';
            }
        }

        chatbotSend.addEventListener('click', sendChat);
        chatbotInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') sendChat(); });

        // Page transitions
        const pageTransition = document.getElementById('pageTransition');
        const transitionLinks = document.querySelectorAll('a[href$=".html"]');

        transitionLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const href = link.getAttribute('href');
                if (href === window.location.pathname.split('/').pop() || href.startsWith('http')) return;

                e.preventDefault();
                pageTransition.classList.add('active');

                setTimeout(() => {
                    window.location.href = href;
                }, 400);
            });
        });
    </script>
    <script src="js/nav-auth.js"></script>
    <script src="js/accessibility.js"></script>
</body>

</html>